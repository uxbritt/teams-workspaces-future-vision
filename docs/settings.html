<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>CTCT for Teams — Settings</title>
  <link rel="stylesheet" href="mobile-responsive.css">
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            main: {
              50: '#f6fcff', 100: '#e6f8ff', 200: '#d6eafe', 300: '#a6d3fd',
              400: '#65abff', 500: '#468af1', 600: '#186ded', 700: '#085fe2',
              800: '#1357be', 900: '#0046ae', 950: '#0b3c85'
            },
            neutral: {
              50: '#fcfcfd', 100: '#f7f9fd', 200: '#f0f4fa', 300: '#dce2ec',
              400: '#c9d0de', 500: '#8d9bb6', 600: '#6b7492', 700: '#63708a',
              800: '#5d687e', 900: '#3f4b63', 950: '#313b4d'
            },
            success: { 500: '#47cd89', 600: '#17b26a', 700: '#079455' },
            danger: { 500: '#fe5a58', 600: '#f04438' },
            warning: { 500: '#ffb26b', 600: '#f79009' },
            accent: { 500: '#a48afb', 600: '#875bf7', 700: '#7839ee' }
          },
          fontFamily: { sans: ['CTSans', 'system-ui', 'sans-serif'] }
        }
      }
    }
  </script>
  <style>
    @font-face { font-family: 'CTSans'; src: url('fonts/CTSans-Regular.woff2') format('woff2'); font-weight: 400; }
    @font-face { font-family: 'CTSans'; src: url('fonts/CTSans-Semibold.woff2') format('woff2'); font-weight: 600; }
    @font-face { font-family: 'CTSans'; src: url('fonts/CTSans-Bold.woff2') format('woff2'); font-weight: 700; }
    body { background: #f7f9fd; line-height: 1.5; }
    .role-badge { padding: 2px 8px; border-radius: 4px; font-size: 12px; font-weight: 500; }
    .role-admin { background: #e6f8ff; color: #085fe2; }
    .role-creator { background: #ecfdf3; color: #079455; }
    .role-viewer { background: #f0f4fa; color: #6b7492; }
    .privacy-open { background: #ecfdf3; color: #079455; }
    .privacy-private { background: #fff8eb; color: #d55b03; }
    .privacy-hidden { background: #f0f4fa; color: #6b7492; }
    .nav-item { display: flex; align-items: center; gap: 10px; padding: 10px 12px; border-radius: 8px; font-size: 14px; color: #6b7492; transition: all 0.15s; }
    .nav-item:hover { background: #f0f4fa; color: #3f4b63; }
    .nav-item.active { background: #e6f8ff; color: #085fe2; font-weight: 500; }
  </style>
</head>
<body class="min-h-screen font-sans text-neutral-800">

  <!-- TOP BAR - Fixed, matches org dashboard exactly -->
  <header class="fixed top-0 left-0 right-0 h-16 bg-white border-b border-neutral-100 flex items-center px-6 z-50">
    <!-- Logo -->
    <div class="flex items-center">
      <img src="assets/ctctLogo.png" alt="Constant Contact" class="w-8 h-8 object-contain">
    </div>

    <!-- Center - Search and Create -->
    <div class="flex items-center gap-3 mx-auto">
      <div class="relative">
        <input type="text" placeholder="Search" class="w-48 pl-4 pr-10 py-2 border border-neutral-200 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-main-500 focus:border-transparent">
        <svg class="w-4 h-4 text-neutral-400 absolute right-3 top-1/2 -translate-y-1/2" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.3-4.3"/></svg>
      </div>
      <div class="relative">
        <button onclick="toggleDropdown('create-dropdown')" class="px-6 py-2 bg-main-500 hover:opacity-90 text-white rounded-lg font-medium text-sm">
          Create
        </button>
        <div id="create-dropdown" class="hidden absolute left-1/2 -translate-x-1/2 top-full mt-2 w-56 bg-white rounded-2xl shadow-xl border border-neutral-100 py-3 z-[60]">
          <a href="#" class="flex items-center gap-3 px-4 py-2.5 text-sm text-neutral-700 hover:bg-neutral-50 rounded-xl mx-1">
            <svg class="w-4 h-4 text-neutral-400" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="2" y="4" width="20" height="16" rx="2"/><path d="m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7"/></svg>
            Email Campaign
          </a>
          <a href="#" class="flex items-center gap-3 px-4 py-2.5 text-sm text-neutral-700 hover:bg-neutral-50 rounded-xl mx-1">
            <svg class="w-4 h-4 text-neutral-400" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/></svg>
            SMS Campaign
          </a>
          <a href="#" class="flex items-center gap-3 px-4 py-2.5 text-sm text-neutral-700 hover:bg-neutral-50 rounded-xl mx-1">
            <svg class="w-4 h-4 text-neutral-400" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 2h-3a5 5 0 0 0-5 5v3H7v4h3v8h4v-8h3l1-4h-4V7a1 1 0 0 1 1-1h3z"/></svg>
            Social Post
          </a>
        </div>
      </div>
    </div>

    <!-- Right side -->
    <div class="flex items-center gap-3">
      <!-- User Avatar Dropdown -->
      <div class="relative">
        <button onclick="toggleDropdown('user-dropdown')" id="user-avatar-btn" class="w-9 h-9 rounded-full overflow-hidden border-2 border-transparent hover:border-main-200 transition-colors">
        </button>
        <div id="user-dropdown" class="hidden absolute right-0 top-full mt-2 w-64 bg-white rounded-2xl shadow-xl border border-neutral-100 py-4 z-[60]">
          <div class="flex items-center gap-3 px-5 pb-4 border-b border-neutral-100">
            <div id="user-avatar-large" class="w-14 h-14 rounded-full overflow-hidden ring-2">
            </div>
            <div>
              <p class="text-base font-semibold text-neutral-800" id="user-name-display"></p>
              <p class="text-sm text-neutral-500" id="user-role-display"></p>
            </div>
          </div>
          <div class="pt-3 px-2">
            <a href="#" class="block px-4 py-3 text-base text-neutral-600 hover:bg-neutral-50 rounded-xl transition-colors">Profile</a>
            <a href="persona-select.html" class="block px-4 py-3 text-base text-neutral-600 hover:bg-neutral-50 rounded-xl transition-colors">Switch user</a>
            <a href="#" class="block px-4 py-3 text-base text-neutral-600 hover:bg-neutral-50 rounded-xl transition-colors">Log out</a>
          </div>
        </div>
      </div>

      <!-- Organization Dropdown -->
      <div class="relative">
        <button onclick="toggleDropdown('org-dropdown')" class="flex items-center gap-2 px-3 py-2 hover:bg-neutral-50 rounded-lg text-sm transition-colors">
          <img src="assets/upsLogo.png" alt="UPS" class="w-6 h-6 object-contain">
          <span class="text-neutral-700 font-medium" id="enterprise-name">UPS Global</span>
          <svg class="w-4 h-4 text-neutral-400" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="m6 9 6 6 6-6"/></svg>
        </button>
        <div id="org-dropdown" class="hidden absolute right-0 top-full mt-2 w-72 bg-white rounded-2xl shadow-xl border border-neutral-100 py-4 z-[60]">
          <div class="flex items-center gap-3 px-5 pb-4 border-b border-neutral-100">
            <div class="w-14 h-14 rounded-xl bg-neutral-100 flex items-center justify-center overflow-hidden">
              <img src="assets/upsLogo.png" alt="UPS" class="w-10 h-10 object-contain">
            </div>
            <div>
              <p class="text-base font-semibold text-neutral-800">UPS Global</p>
              <p class="text-sm text-neutral-500">Enterprise</p>
            </div>
          </div>
          <div class="pt-3 px-2">
            <a href="settings.html?tab=people" class="block px-4 py-3 text-base text-neutral-600 hover:bg-neutral-50 rounded-xl transition-colors">Members</a>
            <a href="settings.html?tab=workspaces" class="block px-4 py-3 text-base text-neutral-600 hover:bg-neutral-50 rounded-xl transition-colors">Workspaces</a>
            <a href="#" class="block px-4 py-3 text-base text-neutral-600 hover:bg-neutral-50 rounded-xl transition-colors">Plans and pricing</a>
          </div>
        </div>
      </div>

      <!-- Notifications Dropdown -->
      <div class="relative">
        <button onclick="toggleDropdown('notifications-dropdown')" class="p-2 text-main-500 hover:bg-main-50 rounded-lg relative transition-colors">
          <svg class="w-5 h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M6 8a6 6 0 0 1 12 0c0 7 3 9 3 9H3s3-2 3-9"/><path d="M10.3 21a1.94 1.94 0 0 0 3.4 0"/></svg>
          <span class="absolute top-1.5 right-1.5 w-2.5 h-2.5 bg-warning-500 rounded-full border-2 border-white"></span>
        </button>
        <div id="notifications-dropdown" class="hidden absolute right-0 top-full mt-2 w-80 bg-white rounded-2xl shadow-xl border border-neutral-100 z-[60]">
          <div class="flex items-center justify-between px-5 py-4 border-b border-neutral-100">
            <h3 class="text-xs font-semibold text-neutral-500 uppercase tracking-wide">Recent Activity</h3>
          </div>
          <div class="max-h-64 overflow-y-auto p-3 space-y-2">
            <div class="flex items-start gap-3 p-3 rounded-xl hover:bg-neutral-50 transition-colors">
              <div class="w-10 h-10 bg-green-100 rounded-full flex items-center justify-center flex-shrink-0">
                <svg class="w-5 h-5 text-green-600" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><line x1="19" y1="8" x2="19" y2="14"/><line x1="22" y1="11" x2="16" y2="11"/></svg>
              </div>
              <div class="flex-1">
                <p class="text-sm font-medium text-neutral-800">New member added</p>
                <p class="text-xs text-neutral-500">David Kim joined UPS New York</p>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Help -->
      <button class="p-2 text-neutral-400 hover:text-neutral-600 hover:bg-neutral-100 rounded-lg">
        <svg class="w-5 h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"/><line x1="12" y1="17" x2="12.01" y2="17"/></svg>
      </button>
    </div>
  </header>

  <!-- Layout with Left Nav -->
  <div class="flex min-h-screen pt-16">
    
    <!-- Left Sidebar Navigation -->
    <aside class="w-56 bg-white border-r border-neutral-100 fixed left-0 top-16 bottom-0 overflow-y-auto">
      <!-- Back Link (dynamic based on role) -->
      <div class="p-4 border-b border-neutral-100">
        <a id="back-link" href="option-b-northstar-empty.html" class="flex items-center gap-2 text-sm text-neutral-600 hover:text-neutral-800 transition-colors">
          <svg class="w-4 h-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="m15 18-6-6 6-6"/></svg>
          <span id="back-link-text">Back to Dashboard</span>
        </a>
      </div>
      
      <!-- Settings Navigation -->
      <div class="p-4">
        <h3 class="text-xs font-semibold text-neutral-400 uppercase tracking-wide mb-3">Settings</h3>
        <nav class="space-y-1">
          <button onclick="switchTab('people')" id="nav-people" class="nav-item w-full active">
            <svg class="w-5 h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M22 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg>
            People
          </button>
          <button onclick="switchTab('workspaces')" id="nav-workspaces" class="nav-item w-full">
            <svg class="w-5 h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="2" y="7" width="20" height="14" rx="2" ry="2"/><path d="M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16"/></svg>
            Workspaces
          </button>
        </nav>
      </div>
    </aside>
    
    <!-- Main Content -->
    <main class="flex-1 ml-56 p-8">
      
      <!-- Tab Content: People -->
      <div id="content-people" class="">
      
      <!-- Info Card -->
      <div class="bg-white rounded-xl border border-neutral-200 p-6 mb-6">
        <h3 class="text-lg font-semibold text-neutral-900 mb-2" id="people-title">Members of UPS Global</h3>
        <p class="text-neutral-600 text-sm mb-6" id="people-description">
          This is a table of all members in your organization. A <strong>Viewer</strong> has access to view campaigns and reports. 
          A <strong>Creator</strong> can create and edit campaigns. An <strong>Admin</strong> can manage members and workspace settings.
        </p>
        
        <!-- Stats Row -->
        <div class="flex items-center gap-8 p-4 bg-neutral-50 rounded-lg mb-6">
          <div>
            <div class="text-2xl font-bold text-neutral-900" id="stat-total">54</div>
            <div class="text-sm text-neutral-500">Total members</div>
          </div>
          <div class="w-px h-10 bg-neutral-200"></div>
          <div>
            <div class="text-2xl font-bold text-neutral-900" id="stat-admins">7</div>
            <div class="text-sm text-neutral-500">Admins</div>
          </div>
          <div class="w-px h-10 bg-neutral-200"></div>
          <div>
            <div class="text-2xl font-bold text-neutral-900" id="stat-creators">18</div>
            <div class="text-sm text-neutral-500">Creators</div>
          </div>
          <div class="w-px h-10 bg-neutral-200"></div>
          <div>
            <div class="text-2xl font-bold text-neutral-900" id="stat-viewers">29</div>
            <div class="text-sm text-neutral-500">Viewers</div>
          </div>
          <div class="flex-1"></div>
          <button onclick="openAddMemberModal()" id="add-member-btn" class="px-4 py-2.5 bg-main-500 text-white rounded-lg text-sm font-medium hover:bg-main-600 transition-colors flex items-center gap-2">
            <svg class="w-4 h-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
            Add new members
          </button>
        </div>
        
        <!-- Search and Filters -->
        <div class="flex items-center gap-4 mb-4">
          <div class="flex-1 max-w-sm relative">
            <svg class="absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-neutral-400" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.3-4.3"/></svg>
            <input type="text" placeholder="Search for account members" class="w-full pl-10 pr-4 py-2 border border-neutral-200 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-main-500" id="member-search" oninput="filterMembers()">
          </div>
          <div class="relative">
            <button onclick="toggleDropdown('role-filter')" class="px-4 py-2 border border-neutral-200 rounded-lg text-sm text-neutral-700 hover:bg-neutral-50 flex items-center gap-2">
              <span id="role-filter-label">All roles</span>
              <svg class="w-4 h-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="m6 9 6 6 6-6"/></svg>
            </button>
            <div id="role-filter" class="hidden absolute right-0 top-full mt-1 w-48 bg-white border border-neutral-200 rounded-lg shadow-lg z-10 py-1">
              <button onclick="setRoleFilter('all')" class="w-full text-left px-4 py-2 text-sm text-neutral-700 hover:bg-neutral-50 flex items-center gap-2">
                <span class="w-4 h-4 flex items-center justify-center text-main-500" id="check-all">✓</span> All roles
              </button>
              <button onclick="setRoleFilter('admin')" class="w-full text-left px-4 py-2 text-sm text-neutral-700 hover:bg-neutral-50 flex items-center gap-2">
                <span class="w-4 h-4 flex items-center justify-center text-main-500 hidden" id="check-admin">✓</span> Admin
              </button>
              <button onclick="setRoleFilter('creator')" class="w-full text-left px-4 py-2 text-sm text-neutral-700 hover:bg-neutral-50 flex items-center gap-2">
                <span class="w-4 h-4 flex items-center justify-center text-main-500 hidden" id="check-creator">✓</span> Creator
              </button>
              <button onclick="setRoleFilter('viewer')" class="w-full text-left px-4 py-2 text-sm text-neutral-700 hover:bg-neutral-50 flex items-center gap-2">
                <span class="w-4 h-4 flex items-center justify-center text-main-500 hidden" id="check-viewer">✓</span> Viewer
              </button>
            </div>
          </div>
          <div class="text-sm text-neutral-500" id="member-count">Showing <strong>1 – 25</strong> of <strong>54</strong> members</div>
        </div>
        
        <!-- Members Table -->
        <div class="border border-neutral-200 rounded-lg overflow-hidden">
          <table class="w-full">
            <thead class="bg-neutral-50 border-b border-neutral-200">
              <tr>
                <th class="text-left px-4 py-3 text-sm font-medium text-neutral-600">Account member</th>
                <th class="text-left px-4 py-3 text-sm font-medium text-neutral-600">Role</th>
                <th class="text-left px-4 py-3 text-sm font-medium text-neutral-600">Workspaces</th>
                <th class="text-left px-4 py-3 text-sm font-medium text-neutral-600">Last active</th>
                <th class="w-12 px-4 py-3"></th>
              </tr>
            </thead>
            <tbody id="members-table-body">
              <!-- Members will be rendered here -->
            </tbody>
          </table>
        </div>
        
        <!-- Restricted Access Notice (for non-global roles) -->
        <div id="people-restricted-notice" class="hidden mt-6 p-4 bg-warning-50 border border-warning-200 rounded-lg">
          <div class="flex items-start gap-3">
            <svg class="w-5 h-5 text-warning-600 mt-0.5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/></svg>
            <div>
              <p class="text-sm font-medium text-warning-800" id="restricted-title">Limited Access</p>
              <p class="text-sm text-warning-700" id="restricted-message">You can only manage members in workspaces you have access to.</p>
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <!-- Tab Content: Workspaces -->
    <div id="content-workspaces" class="hidden">
      
      <!-- Info Card -->
      <div class="bg-white rounded-xl border border-neutral-200 p-6 mb-6">
        <h3 class="text-lg font-semibold text-neutral-900 mb-2" id="workspaces-title">Workspaces in UPS Global</h3>
        <p class="text-neutral-600 text-sm mb-6" id="workspaces-description">
          This page displays the workspaces you have permission to view. Here, you can manage workspaces, such as adding members and assigning workspace-level permissions.
        </p>
        
        <!-- Stats Row -->
        <div class="flex items-center gap-8 p-4 bg-neutral-50 rounded-lg mb-6">
          <div>
            <div class="text-2xl font-bold text-neutral-900" id="stat-active-ws">32</div>
            <div class="text-sm text-neutral-500">Active workspaces</div>
          </div>
          <div class="w-px h-10 bg-neutral-200"></div>
          <div>
            <div class="text-2xl font-bold text-neutral-900" id="stat-archived-ws">3</div>
            <div class="text-sm text-neutral-500">Archived workspaces</div>
          </div>
          <div class="flex-1"></div>
          <button onclick="openCreateWorkspaceModal()" id="create-workspace-btn" class="px-4 py-2.5 bg-main-500 text-white rounded-lg text-sm font-medium hover:bg-main-600 transition-colors flex items-center gap-2">
            <svg class="w-4 h-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
            Create workspace
          </button>
        </div>
        
        <!-- Workspace Tabs -->
        <div class="flex gap-4 mb-4">
          <button onclick="setWorkspaceFilter('active')" id="ws-tab-active" class="px-4 py-2 text-sm font-medium text-main-600 border-b-2 border-main-500">Active workspaces</button>
          <button onclick="setWorkspaceFilter('archived')" id="ws-tab-archived" class="px-4 py-2 text-sm font-medium text-neutral-500 border-b-2 border-transparent hover:text-neutral-700">Archived workspaces</button>
        </div>
        
        <!-- Search and Filters -->
        <div class="flex items-center gap-4 mb-4">
          <div class="flex-1 max-w-sm relative">
            <svg class="absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-neutral-400" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.3-4.3"/></svg>
            <input type="text" placeholder="Search for workspaces" class="w-full pl-10 pr-4 py-2 border border-neutral-200 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-main-500" id="workspace-search" oninput="filterWorkspaces()">
          </div>
          <div class="relative">
            <button onclick="toggleDropdown('privacy-filter')" class="px-4 py-2 border border-neutral-200 rounded-lg text-sm text-neutral-700 hover:bg-neutral-50 flex items-center gap-2">
              <span id="privacy-filter-label">All privacy types</span>
              <svg class="w-4 h-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="m6 9 6 6 6-6"/></svg>
            </button>
            <div id="privacy-filter" class="hidden absolute right-0 top-full mt-1 w-56 bg-white border border-neutral-200 rounded-lg shadow-lg z-10 py-1">
              <button onclick="setPrivacyFilter('all')" class="w-full text-left px-4 py-2 text-sm text-neutral-700 hover:bg-neutral-50">All privacy types</button>
              <button onclick="setPrivacyFilter('open')" class="w-full text-left px-4 py-2 text-sm text-neutral-700 hover:bg-neutral-50">Open workspaces</button>
              <button onclick="setPrivacyFilter('private')" class="w-full text-left px-4 py-2 text-sm text-neutral-700 hover:bg-neutral-50">Private workspaces</button>
              <button onclick="setPrivacyFilter('hidden')" class="w-full text-left px-4 py-2 text-sm text-neutral-700 hover:bg-neutral-50">Hidden workspaces</button>
            </div>
          </div>
          <label class="flex items-center gap-2 text-sm text-neutral-600">
            <input type="checkbox" class="w-4 h-4 rounded border-neutral-300 text-main-500 focus:ring-main-500" id="only-my-workspaces">
            Only your workspaces
          </label>
          <div class="text-sm text-neutral-500" id="workspace-count">Showing <strong>1 – 10</strong> of <strong>32</strong> workspaces</div>
        </div>
        
        <!-- Workspaces List -->
        <div class="space-y-3" id="workspaces-list">
          <!-- Workspaces will be rendered here -->
        </div>
        
        <!-- Request Access Notice (for location role) -->
        <div id="workspace-request-notice" class="hidden mt-6 p-4 bg-main-50 border border-main-200 rounded-lg">
          <div class="flex items-start gap-3">
            <svg class="w-5 h-5 text-main-600 mt-0.5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><path d="M12 16v-4"/><path d="M12 8h.01"/></svg>
            <div class="flex-1">
              <p class="text-sm font-medium text-main-800">Need access to another workspace?</p>
              <p class="text-sm text-main-700 mb-3">Request access from your organization admin to collaborate in other workspaces.</p>
              <button onclick="openRequestAccessModal()" class="px-4 py-2 bg-main-500 text-white rounded-lg text-sm font-medium hover:bg-main-600 transition-colors">
                Request access
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
    
    </main>
  </div>
  
  <!-- Add Member Modal -->
  <div id="add-member-modal" class="hidden fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4">
    <div class="bg-white rounded-xl max-w-lg w-full max-h-[90vh] overflow-auto">
      <div class="p-6 border-b border-neutral-200">
        <div class="flex items-center justify-between">
          <h3 class="text-lg font-semibold text-neutral-900">Add new members</h3>
          <button onclick="closeAddMemberModal()" class="p-1 text-neutral-400 hover:text-neutral-600 rounded">
            <svg class="w-5 h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>
          </button>
        </div>
      </div>
      <div class="p-6">
        <label class="block text-sm font-medium text-neutral-700 mb-2">Email addresses</label>
        <textarea class="w-full px-4 py-3 border border-neutral-200 rounded-lg text-sm resize-none focus:outline-none focus:ring-2 focus:ring-main-500" rows="3" placeholder="Enter email addresses, separated by commas"></textarea>
        
        <label class="block text-sm font-medium text-neutral-700 mb-2 mt-4">Role</label>
        <select class="w-full px-4 py-2.5 border border-neutral-200 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-main-500">
          <option value="viewer">Viewer</option>
          <option value="creator">Creator</option>
          <option value="admin">Admin</option>
        </select>
        
        <label class="block text-sm font-medium text-neutral-700 mb-2 mt-4">Add to workspaces</label>
        <div class="border border-neutral-200 rounded-lg max-h-40 overflow-auto p-2" id="workspace-checkboxes">
          <!-- Workspace checkboxes will be populated here -->
        </div>
      </div>
      <div class="p-6 border-t border-neutral-200 flex justify-end gap-3">
        <button onclick="closeAddMemberModal()" class="px-4 py-2 border border-neutral-200 rounded-lg text-sm text-neutral-700 hover:bg-neutral-50">Cancel</button>
        <button class="px-4 py-2 bg-main-500 text-white rounded-lg text-sm font-medium hover:bg-main-600">Send invites</button>
      </div>
    </div>
  </div>
  
  <!-- Request Access Modal -->
  <div id="request-access-modal" class="hidden fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4">
    <div class="bg-white rounded-xl max-w-lg w-full">
      <div class="p-6 border-b border-neutral-200">
        <div class="flex items-center justify-between">
          <h3 class="text-lg font-semibold text-neutral-900">Request workspace access</h3>
          <button onclick="closeRequestAccessModal()" class="p-1 text-neutral-400 hover:text-neutral-600 rounded">
            <svg class="w-5 h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>
          </button>
        </div>
      </div>
      <div class="p-6">
        <label class="block text-sm font-medium text-neutral-700 mb-2">Select workspace</label>
        <select class="w-full px-4 py-2.5 border border-neutral-200 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-main-500" id="request-workspace-select">
          <option value="">Choose a workspace...</option>
        </select>
        
        <label class="block text-sm font-medium text-neutral-700 mb-2 mt-4">Reason for access (optional)</label>
        <textarea class="w-full px-4 py-3 border border-neutral-200 rounded-lg text-sm resize-none focus:outline-none focus:ring-2 focus:ring-main-500" rows="3" placeholder="Explain why you need access to this workspace"></textarea>
      </div>
      <div class="p-6 border-t border-neutral-200 flex justify-end gap-3">
        <button onclick="closeRequestAccessModal()" class="px-4 py-2 border border-neutral-200 rounded-lg text-sm text-neutral-700 hover:bg-neutral-50">Cancel</button>
        <button onclick="submitAccessRequest()" class="px-4 py-2 bg-main-500 text-white rounded-lg text-sm font-medium hover:bg-main-600">Send request</button>
      </div>
    </div>
  </div>
  
  <!-- Member Menu Modal -->
  <div id="member-menu" class="hidden absolute bg-white border border-neutral-200 rounded-lg shadow-lg z-20 py-1 w-48">
    <button class="w-full text-left px-4 py-2 text-sm text-neutral-700 hover:bg-neutral-50">View member profile</button>
    <button class="w-full text-left px-4 py-2 text-sm text-neutral-700 hover:bg-neutral-50" id="change-role-btn">Change role</button>
    <button class="w-full text-left px-4 py-2 text-sm text-danger-600 hover:bg-neutral-50" id="remove-member-btn">Remove from organization</button>
  </div>

  <script>
    // Role-based data and access control
    const userRole = sessionStorage.getItem('accessLevel') || new URLSearchParams(window.location.search).get('role') || 'global';
    const userName = sessionStorage.getItem('userName') || 'Sarah Chen';
    const userTitle = sessionStorage.getItem('userTitle') || 'Global Marketing Director';
    const accessScope = sessionStorage.getItem('accessScope') || 'all';
    const accessFolder = sessionStorage.getItem('accessFolder') || '';
    const accessWorkspace = sessionStorage.getItem('accessWorkspace') || '';

    // Update user avatar and info based on current persona
    function updateUserAvatar() {
      // Map personas to their avatar data with actual photos
      const personaData = {
        'Sarah Chen': { 
          photo: 'https://images.unsplash.com/photo-1573496359142-b8d87734a5a2?w=200&h=200&fit=crop&crop=face',
          title: 'Global Marketing Director',
          ringColor: 'ring-emerald-500'
        },
        'Mike Johnson': { 
          photo: 'https://images.unsplash.com/photo-1472099645785-5658abf4ff4e?w=200&h=200&fit=crop&crop=face',
          title: 'US Northeast Regional Manager',
          ringColor: 'ring-blue-500'
        },
        'Jessica Martinez': { 
          photo: 'https://images.unsplash.com/photo-1580489944761-15a19d654956?w=200&h=200&fit=crop&crop=face',
          title: 'NY Location Manager',
          ringColor: 'ring-purple-500'
        }
      };
      
      const persona = personaData[userName] || personaData['Sarah Chen'];
      
      // Update small avatar button in topbar
      const avatarBtn = document.getElementById('user-avatar-btn');
      if (avatarBtn) {
        avatarBtn.className = `w-9 h-9 rounded-full overflow-hidden border-2 border-transparent hover:border-main-200 transition-colors ${persona.ringColor}`;
        avatarBtn.innerHTML = `<img src="${persona.photo}" alt="${userName}" class="w-full h-full object-cover">`;
      }
      
      // Update large avatar in dropdown
      const avatarLarge = document.getElementById('user-avatar-large');
      if (avatarLarge) {
        avatarLarge.className = `w-14 h-14 rounded-full overflow-hidden ${persona.ringColor} ring-2`;
        avatarLarge.innerHTML = `<img src="${persona.photo}" alt="${userName}" class="w-full h-full object-cover">`;
      }
      
      // Update name and title in dropdown
      const nameDisplay = document.getElementById('user-name-display');
      if (nameDisplay) {
        nameDisplay.textContent = userName;
      }
      
      const roleDisplay = document.getElementById('user-role-display');
      if (roleDisplay) {
        roleDisplay.textContent = userTitle;
      }
    }
    
    // Full member data (all organization members)
    const allMembers = [
      { name: 'Sarah Chen', email: 'sarah.chen@ups.com', role: 'admin', workspaces: 'All workspaces', lastActive: 'Today', region: 'global' },
      { name: 'Mike Johnson', email: 'mike.johnson@ups.com', role: 'admin', workspaces: '18 workspaces', lastActive: '2 days ago', region: 'US' },
      { name: 'Emily Rodriguez', email: 'emily.r@ups.com', role: 'admin', workspaces: '14 workspaces', lastActive: '1 week ago', region: 'EU' },
      { name: 'David Kim', email: 'david.kim@ups.com', role: 'creator', workspaces: '5 workspaces', lastActive: 'Yesterday', region: 'Northeast' },
      { name: 'Jessica Martinez', email: 'jessica.m@ups.com', role: 'creator', workspaces: '1 workspace', lastActive: 'Today', region: 'New York' },
      { name: 'Robert Taylor', email: 'robert.t@ups.com', role: 'creator', workspaces: '4 workspaces', lastActive: '3 days ago', region: 'Southeast' },
      { name: 'Amanda White', email: 'amanda.w@ups.com', role: 'creator', workspaces: '3 workspaces', lastActive: '5 days ago', region: 'Southwest' },
      { name: 'Michael Brown', email: 'michael.b@ups.com', role: 'viewer', workspaces: '2 workspaces', lastActive: '1 month ago', region: 'Northeast' },
      { name: 'Lisa Anderson', email: 'lisa.a@ups.com', role: 'viewer', workspaces: '1 workspace', lastActive: '2 weeks ago', region: 'New York' },
      { name: 'James Wilson', email: 'james.w@ups.com', role: 'viewer', workspaces: '6 workspaces', lastActive: 'Yesterday', region: 'EU' },
      { name: 'Jennifer Davis', email: 'jennifer.d@ups.com', role: 'creator', workspaces: '4 workspaces', lastActive: '4 days ago', region: 'Northeast' },
      { name: 'Christopher Lee', email: 'chris.lee@ups.com', role: 'viewer', workspaces: '2 workspaces', lastActive: '1 week ago', region: 'Northeast' },
      { name: 'Patricia Garcia', email: 'patricia.g@ups.com', role: 'creator', workspaces: '3 workspaces', lastActive: 'Today', region: 'US' },
      { name: 'Daniel Martinez', email: 'daniel.m@ups.com', role: 'viewer', workspaces: '1 workspace', lastActive: '3 weeks ago', region: 'New York' },
      { name: 'Nancy Thompson', email: 'nancy.t@ups.com', role: 'admin', workspaces: '5 workspaces', lastActive: 'Yesterday', region: 'Northeast' }
    ];
    
    // Full workspace data
    const allWorkspaces = [
      // US Northeast
      { name: 'UPS New York', privacy: 'open', members: 12, folder: 'UPS Northeast', region: 'US', isMember: true },
      { name: 'UPS Connecticut', privacy: 'open', members: 8, folder: 'UPS Northeast', region: 'US', isMember: false },
      { name: 'UPS Massachusetts', privacy: 'private', members: 10, folder: 'UPS Northeast', region: 'US', isMember: false },
      { name: 'UPS New Jersey', privacy: 'open', members: 9, folder: 'UPS Northeast', region: 'US', isMember: false },
      { name: 'UPS Pennsylvania', privacy: 'open', members: 11, folder: 'UPS Northeast', region: 'US', isMember: false },
      // US Southeast
      { name: 'UPS Florida', privacy: 'open', members: 15, folder: 'UPS Southeast', region: 'US', isMember: false },
      { name: 'UPS Georgia', privacy: 'open', members: 8, folder: 'UPS Southeast', region: 'US', isMember: false },
      { name: 'UPS North Carolina', privacy: 'private', members: 7, folder: 'UPS Southeast', region: 'US', isMember: false },
      // US Southwest
      { name: 'UPS Texas', privacy: 'open', members: 18, folder: 'UPS Southwest', region: 'US', isMember: false },
      { name: 'UPS Arizona', privacy: 'hidden', members: 5, folder: 'UPS Southwest', region: 'US', isMember: false },
      // EU
      { name: 'UPS London', privacy: 'open', members: 14, folder: 'UPS UK & Ireland', region: 'EU', isMember: false },
      { name: 'UPS Germany', privacy: 'open', members: 12, folder: 'UPS DACH', region: 'EU', isMember: false },
      // Global
      { name: 'UPS Foundation', privacy: 'private', members: 6, folder: null, region: 'Global', isMember: false },
      { name: 'UPS Student Program', privacy: 'open', members: 4, folder: null, region: 'Global', isMember: false }
    ];
    
    // Current filter states
    let currentRoleFilter = 'all';
    let currentPrivacyFilter = 'all';
    let currentWorkspaceStatus = 'active';
    
    // Initialize based on role
    function initializeForRole() {
      // Update user avatar first
      updateUserAvatar();
      
      // Update user info in top bar
      const userNameDisplay = document.getElementById('user-name-display');
      const userRoleDisplay = document.getElementById('user-role-display');
      const enterpriseName = document.getElementById('enterprise-name');
      
      if (userNameDisplay) userNameDisplay.textContent = userName;
      
      // Enterprise name always stays as "UPS Global"
      if (enterpriseName) enterpriseName.textContent = 'UPS Global';
      
      // Update titles based on role
      if (userRole === 'global') {
        // Full access - show everything
        if (userRoleDisplay) userRoleDisplay.textContent = 'Global Admin';
        document.getElementById('people-title').textContent = 'Members of UPS Global';
        document.getElementById('workspaces-title').textContent = 'Workspaces in UPS Global';
      } else if (userRole === 'regional') {
        // Regional access - limited to Northeast or specific folder
        const folderName = accessFolder || 'UPS Northeast';
        if (userRoleDisplay) userRoleDisplay.textContent = 'Regional Manager';
        document.getElementById('people-title').textContent = 'Members of ' + folderName;
        document.getElementById('workspaces-title').textContent = 'Workspaces in ' + folderName;
        document.getElementById('people-description').textContent = 'Manage members in your region. You can add members to workspaces within ' + folderName + ' and share workspaces with other team members.';
        document.getElementById('workspaces-description').textContent = 'Manage workspaces within your region. You can create new workspaces and add members within ' + folderName + '.';
        document.getElementById('people-restricted-notice').classList.remove('hidden');
        document.getElementById('restricted-message').textContent = 'You can add and manage members in ' + folderName + ' workspaces only. Organization-wide changes require admin access.';
      } else if (userRole === 'location' || userRole === 'workspace') {
        // Location/workspace level - very limited access
        const wsName = accessWorkspace || 'UPS New York';
        if (userRoleDisplay) userRoleDisplay.textContent = 'Location Manager';
        document.getElementById('people-title').textContent = 'Members of ' + wsName;
        document.getElementById('workspaces-title').textContent = 'Your Workspace';
        document.getElementById('people-description').textContent = 'View and add members to your workspace. Contact an admin for organization-level changes.';
        document.getElementById('workspaces-description').textContent = 'You have access to one workspace. Request access from your admin to collaborate in other workspaces.';
        document.getElementById('people-restricted-notice').classList.remove('hidden');
        document.getElementById('restricted-title').textContent = 'Workspace-Level Access';
        document.getElementById('restricted-message').textContent = 'You can only add members to ' + wsName + '. To remove members or change roles, contact your admin.';
        document.getElementById('workspace-request-notice').classList.remove('hidden');
        document.getElementById('create-workspace-btn').classList.add('hidden');
        // Change button text
        document.getElementById('add-member-btn').innerHTML = `
          <svg class="w-4 h-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
          Add members
        `;
        
        // Update back link to go to workspace instead of org dashboard
        const backLink = document.getElementById('back-link');
        const backLinkText = document.getElementById('back-link-text');
        if (backLink) backLink.href = 'workspace-detail.html?workspace=' + encodeURIComponent(wsName);
        if (backLinkText) backLinkText.textContent = 'Back to Workspace';
      }
      
      renderMembers();
      renderWorkspaces();
      populateWorkspaceCheckboxes();
      populateRequestWorkspaceOptions();
    }
    
    function getInitials(name) {
      return name.split(' ').map(n => n[0]).join('').toUpperCase().slice(0, 2);
    }
    
    // Filter members based on role access
    function getFilteredMembers() {
      let filtered = [...allMembers];
      
      // Apply role-based filtering
      if (userRole === 'regional') {
        // Show members in Northeast region only
        filtered = filtered.filter(m => 
          m.region === 'Northeast' || 
          m.region === 'New York' ||
          m.region === 'Connecticut' ||
          m.region === 'Massachusetts' ||
          m.region === 'New Jersey' ||
          m.region === 'Pennsylvania'
        );
      } else if (userRole === 'location' || userRole === 'workspace') {
        // Show only workspace members (New York)
        filtered = filtered.filter(m => 
          m.region === 'New York'
        );
      }
      
      // Apply search filter
      const searchTerm = document.getElementById('member-search')?.value?.toLowerCase() || '';
      if (searchTerm) {
        filtered = filtered.filter(m => 
          m.name.toLowerCase().includes(searchTerm) || 
          m.email.toLowerCase().includes(searchTerm)
        );
      }
      
      // Apply role filter
      if (currentRoleFilter !== 'all') {
        filtered = filtered.filter(m => m.role === currentRoleFilter);
      }
      
      return filtered;
    }
    
    // Filter workspaces based on role access
    function getFilteredWorkspaces() {
      let filtered = [...allWorkspaces];
      
      // Apply role-based filtering
      if (userRole === 'regional') {
        // Show only Northeast workspaces
        filtered = filtered.filter(w => w.folder === 'UPS Northeast');
      } else if (userRole === 'location' || userRole === 'workspace') {
        filtered = filtered.filter(w => w.name === (accessWorkspace || 'UPS New York'));
      }
      
      // Apply search filter
      const searchTerm = document.getElementById('workspace-search')?.value?.toLowerCase() || '';
      if (searchTerm) {
        filtered = filtered.filter(w => w.name.toLowerCase().includes(searchTerm));
      }
      
      // Apply privacy filter
      if (currentPrivacyFilter !== 'all') {
        filtered = filtered.filter(w => w.privacy === currentPrivacyFilter);
      }
      
      return filtered;
    }
    
    // Render members table
    function renderMembers() {
      const members = getFilteredMembers();
      const tbody = document.getElementById('members-table-body');
      
      const canChangeRole = userRole === 'global' || userRole === 'regional';
      const canRemove = userRole === 'global';
      
      tbody.innerHTML = members.map((member, idx) => `
        <tr class="border-b border-neutral-100 hover:bg-neutral-50">
          <td class="px-4 py-3">
            <div class="flex items-center gap-3">
              <div class="w-8 h-8 rounded-full bg-neutral-200 flex items-center justify-center text-neutral-600 text-sm font-medium">
                ${getInitials(member.name)}
              </div>
              <div>
                <div class="text-sm font-medium text-neutral-900">${member.name}</div>
                <div class="text-xs text-neutral-500">${member.email}</div>
              </div>
            </div>
          </td>
          <td class="px-4 py-3">
            <span class="role-badge role-${member.role}">${member.role.charAt(0).toUpperCase() + member.role.slice(1)}</span>
          </td>
          <td class="px-4 py-3 text-sm text-main-600">${member.workspaces}</td>
          <td class="px-4 py-3 text-sm text-neutral-500">${member.lastActive}</td>
          <td class="px-4 py-3">
            <button onclick="openMemberMenu(event, ${idx})" class="p-1 text-neutral-400 hover:text-neutral-600 hover:bg-neutral-100 rounded">
              <svg class="w-5 h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="1"/><circle cx="19" cy="12" r="1"/><circle cx="5" cy="12" r="1"/></svg>
            </button>
          </td>
        </tr>
      `).join('');
      
      // Update stats
      updateMemberStats(members);
      
      // Update count text
      document.getElementById('member-count').innerHTML = `Showing <strong>1 – ${Math.min(25, members.length)}</strong> of <strong>${members.length}</strong> members`;
    }
    
    function updateMemberStats(members) {
      const admins = members.filter(m => m.role === 'admin').length;
      const creators = members.filter(m => m.role === 'creator').length;
      const viewers = members.filter(m => m.role === 'viewer').length;
      
      document.getElementById('stat-total').textContent = members.length;
      document.getElementById('stat-admins').textContent = admins;
      document.getElementById('stat-creators').textContent = creators;
      document.getElementById('stat-viewers').textContent = viewers;
    }
    
    // Render workspaces list
    function renderWorkspaces() {
      const workspaces = getFilteredWorkspaces();
      const container = document.getElementById('workspaces-list');
      
      const canAddMembers = true; // All roles can add members to their accessible workspaces
      const canLeave = true;
      const canManage = userRole === 'global' || userRole === 'regional';
      
      container.innerHTML = workspaces.map(ws => `
        <div class="border border-neutral-200 rounded-lg p-4 hover:border-neutral-300 transition-colors">
          <div class="flex items-center justify-between">
            <div class="flex items-center gap-4">
              <div class="flex flex-col">
                <div class="flex items-center gap-2">
                  <span class="font-medium text-neutral-900">${ws.name}</span>
                  <span class="px-2 py-0.5 text-xs rounded privacy-${ws.privacy}">
                    <span class="inline-flex items-center gap-1">
                      ${ws.privacy === 'open' ? '<svg class="w-3 h-3" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="11" width="18" height="11" rx="2" ry="2"/><path d="M7 11V7a5 5 0 0 1 9.9-1"/></svg>' : ws.privacy === 'private' ? '<svg class="w-3 h-3" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="11" width="18" height="11" rx="2" ry="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/></svg>' : '<svg class="w-3 h-3" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24"/><line x1="1" y1="1" x2="23" y2="23"/></svg>'}
                      ${ws.privacy.charAt(0).toUpperCase() + ws.privacy.slice(1)}
                    </span>
                  </span>
                  ${ws.isMember ? '<span class="px-2 py-0.5 bg-main-100 text-main-700 text-xs rounded font-medium">Member</span>' : ''}
                </div>
                <span class="text-sm text-neutral-500 mt-1">${ws.members} workspace members${ws.folder ? ' • ' + ws.folder : ''}</span>
              </div>
            </div>
            <div class="flex items-center gap-2">
              ${ws.isMember ? '<button class="text-sm text-neutral-600 hover:text-neutral-800 px-3 py-1.5 hover:bg-neutral-100 rounded-lg">Leave workspace</button>' : ''}
              <button class="p-2 text-neutral-400 hover:text-neutral-600 hover:bg-neutral-100 rounded-lg">
                <svg class="w-5 h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="1"/><circle cx="19" cy="12" r="1"/><circle cx="5" cy="12" r="1"/></svg>
              </button>
              <button onclick="openAddMembersToWorkspace('${ws.name}')" class="flex items-center gap-1 px-3 py-1.5 border border-neutral-200 rounded-lg text-sm text-neutral-700 hover:bg-neutral-50">
                <svg class="w-4 h-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
                Add members
              </button>
            </div>
          </div>
        </div>
      `).join('');
      
      // Update stats
      document.getElementById('stat-active-ws').textContent = workspaces.length;
      document.getElementById('workspace-count').innerHTML = `Showing <strong>1 – ${Math.min(10, workspaces.length)}</strong> of <strong>${workspaces.length}</strong> workspaces`;
    }
    
    // Tab switching
    function switchTab(tab) {
      // Update left nav styles
      ['people', 'workspaces'].forEach(t => {
        const navItem = document.getElementById(`nav-${t}`);
        const content = document.getElementById(`content-${t}`);
        if (navItem) {
          navItem.classList.toggle('active', t === tab);
        }
        if (content) {
          content.classList.toggle('hidden', t !== tab);
        }
      });
    }
    
    // Dropdown toggle
    function toggleDropdown(id) {
      const dropdown = document.getElementById(id);
      dropdown.classList.toggle('hidden');
      
      // Close on outside click
      if (!dropdown.classList.contains('hidden')) {
        setTimeout(() => {
          document.addEventListener('click', function closeDropdown(e) {
            if (!dropdown.contains(e.target)) {
              dropdown.classList.add('hidden');
              document.removeEventListener('click', closeDropdown);
            }
          });
        }, 0);
      }
    }
    
    // Filter functions
    function setRoleFilter(role) {
      currentRoleFilter = role;
      document.getElementById('role-filter-label').textContent = role === 'all' ? 'All roles' : role.charAt(0).toUpperCase() + role.slice(1);
      document.getElementById('role-filter').classList.add('hidden');
      renderMembers();
    }
    
    function setPrivacyFilter(privacy) {
      currentPrivacyFilter = privacy;
      document.getElementById('privacy-filter-label').textContent = privacy === 'all' ? 'All privacy types' : privacy.charAt(0).toUpperCase() + privacy.slice(1) + ' workspaces';
      document.getElementById('privacy-filter').classList.add('hidden');
      renderWorkspaces();
    }
    
    function setWorkspaceFilter(status) {
      currentWorkspaceStatus = status;
      document.getElementById('ws-tab-active').className = status === 'active' ? 'px-4 py-2 text-sm font-medium text-main-600 border-b-2 border-main-500' : 'px-4 py-2 text-sm font-medium text-neutral-500 border-b-2 border-transparent hover:text-neutral-700';
      document.getElementById('ws-tab-archived').className = status === 'archived' ? 'px-4 py-2 text-sm font-medium text-main-600 border-b-2 border-main-500' : 'px-4 py-2 text-sm font-medium text-neutral-500 border-b-2 border-transparent hover:text-neutral-700';
      renderWorkspaces();
    }
    
    function filterMembers() {
      renderMembers();
    }
    
    function filterWorkspaces() {
      renderWorkspaces();
    }
    
    // Modal functions
    function openAddMemberModal() {
      document.getElementById('add-member-modal').classList.remove('hidden');
    }
    
    function closeAddMemberModal() {
      document.getElementById('add-member-modal').classList.add('hidden');
    }
    
    function openRequestAccessModal() {
      document.getElementById('request-access-modal').classList.remove('hidden');
    }
    
    function closeRequestAccessModal() {
      document.getElementById('request-access-modal').classList.add('hidden');
    }
    
    function openCreateWorkspaceModal() {
      alert('Create workspace modal would open here');
    }
    
    function openAddMembersToWorkspace(workspaceName) {
      alert('Add members to ' + workspaceName);
    }
    
    function submitAccessRequest() {
      const workspace = document.getElementById('request-workspace-select').value;
      if (workspace) {
        alert('Access request sent for ' + workspace);
        closeRequestAccessModal();
      }
    }
    
    function openMemberMenu(event, idx) {
      event.stopPropagation();
      const menu = document.getElementById('member-menu');
      const rect = event.target.closest('button').getBoundingClientRect();
      menu.style.top = rect.bottom + 'px';
      menu.style.left = (rect.left - 150) + 'px';
      menu.classList.remove('hidden');
      
      // Update menu options based on role
      const canChangeRole = userRole === 'global' || userRole === 'regional';
      const canRemove = userRole === 'global';
      document.getElementById('change-role-btn').classList.toggle('hidden', !canChangeRole);
      document.getElementById('remove-member-btn').classList.toggle('hidden', !canRemove);
      
      setTimeout(() => {
        document.addEventListener('click', function closeMenu(e) {
          if (!menu.contains(e.target)) {
            menu.classList.add('hidden');
            document.removeEventListener('click', closeMenu);
          }
        });
      }, 0);
    }
    
    function populateWorkspaceCheckboxes() {
      const workspaces = getFilteredWorkspaces();
      const container = document.getElementById('workspace-checkboxes');
      container.innerHTML = workspaces.map(ws => `
        <label class="flex items-center gap-2 p-2 hover:bg-neutral-50 rounded cursor-pointer">
          <input type="checkbox" class="w-4 h-4 rounded border-neutral-300 text-main-500">
          <span class="text-sm text-neutral-700">${ws.name}</span>
        </label>
      `).join('');
    }
    
    function populateRequestWorkspaceOptions() {
      // Show workspaces user doesn't have access to
      const otherWorkspaces = allWorkspaces.filter(w => !w.isMember && w.name !== (accessWorkspace || 'UPS New York'));
      const select = document.getElementById('request-workspace-select');
      select.innerHTML = '<option value="">Choose a workspace...</option>' + 
        otherWorkspaces.map(ws => `<option value="${ws.name}">${ws.name}</option>`).join('');
    }
    
    // Initialize on load
    document.addEventListener('DOMContentLoaded', initializeForRole);
    
    // Handle URL params for initial tab
    const urlParams = new URLSearchParams(window.location.search);
    const tabParam = urlParams.get('tab');
    if (tabParam && ['people', 'workspaces'].includes(tabParam)) {
      switchTab(tabParam);
    }
  </script>

</body>
</html>

