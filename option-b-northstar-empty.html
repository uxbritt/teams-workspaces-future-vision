<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>CTCT for Teams — Folder Dashboard</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            // Main (Blue)
            main: {
              50: '#f6fcff',
              100: '#e6f8ff',
              200: '#d6eafe',
              300: '#a6d3fd',
              400: '#65abff',
              500: '#468af1',
              600: '#186ded',
              700: '#085fe2',
              800: '#1357be',
              900: '#0046ae',
              950: '#0b3c85'
            },
            // Neutral (Gray)
            neutral: {
              50: '#fcfcfd',
              100: '#f7f9fd',
              200: '#f0f4fa',
              300: '#dce2ec',
              400: '#c9d0de',
              500: '#8d9bb6',
              600: '#6b7492',
              700: '#63708a',
              800: '#5d687e',
              900: '#3f4b63',
              950: '#313b4d'
            },
            // Success (Green)
            success: {
              50: '#f6fef9',
              100: '#ecfdf3',
              200: '#dbfae6',
              300: '#a9efc5',
              400: '#75e0a7',
              500: '#47cd89',
              600: '#17b26a',
              700: '#079455',
              800: '#067647',
              900: '#085d3a',
              950: '#074d31'
            },
            // Danger (Red)
            danger: {
              50: '#fffafa',
              100: '#fef3f2',
              200: '#fee4e2',
              300: '#fecdca',
              400: '#fda29b',
              500: '#fe5a58',
              600: '#f04438',
              700: '#d92d20',
              800: '#b42318',
              900: '#912018',
              950: '#7a271a'
            },
            // Warning (Yellow/Orange)
            warning: {
              50: '#fffcf5',
              100: '#fff8eb',
              200: '#fff2de',
              300: '#ffdaaf',
              400: '#ffca8d',
              500: '#ffb26b',
              600: '#f79009',
              700: '#e97420',
              800: '#d55b03',
              900: '#93370d',
              950: '#792e0d'
            },
            // Accent (Purple)
            accent: {
              50: '#fbfaff',
              100: '#f5f3ff',
              200: '#ece9fe',
              300: '#ddd6fe',
              400: '#c3b5fd',
              500: '#a48afb',
              600: '#875bf7',
              700: '#7839ee',
              800: '#6927da',
              900: '#5720b7',
              950: '#401687'
            },
            // Legacy ctct colors (mapped to new palette)
            ctct: {
              blue: '#468af1',
              'blue-light': '#e6f8ff',
              orange: '#f79009'
            }
          },
          fontFamily: {
            sans: ['CTSans', 'system-ui', 'sans-serif']
          }
        }
      }
    }
  </script>
  <style>
    @font-face {
      font-family: 'CTSans';
      src: url('fonts/CTSans-Regular.woff2') format('woff2');
      font-weight: 400;
      font-style: normal;
      font-display: swap;
    }
    @font-face {
      font-family: 'CTSans';
      src: url('fonts/CTSans-Semibold.woff2') format('woff2');
      font-weight: 600;
      font-style: normal;
      font-display: swap;
    }
    @font-face {
      font-family: 'CTSans';
      src: url('fonts/CTSans-Bold.woff2') format('woff2');
      font-weight: 700;
      font-style: normal;
      font-display: swap;
    }
    body { 
      line-height: 1.5; 
      background: #f7f9fd; /* neutral-100 */
    }
    .nav-item { color: #6b7492; } /* neutral-600 */
    .nav-item:hover { color: #3f4b63; } /* neutral-900 */
    .nav-item.active { font-weight: 600; color: #313b4d; } /* neutral-950 */
    .sub-nav-item { color: #8d9bb6; } /* neutral-500 */
    .sub-nav-item:hover { color: #6b7492; } /* neutral-600 */
    
    /* AI Assistant gradient */
    .ai-gradient-text {
      background: linear-gradient(90deg, #7839ee 0%, #468af1 100%); /* accent-700 to main-500 */
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }
    .ai-gradient-icon {
      stroke: url(#ai-gradient);
    }
    
    /* Combined Theme: Blues for donut, Greens for leaderboards, Multicolor for activity */
    :root {
      /* Donut - Main blues (dark to light) */
      --donut-1: #0b3c85; /* main-950 */
      --donut-2: #1357be; /* main-800 */
      --donut-3: #468af1; /* main-500 */
      --donut-4: #a6d3fd; /* main-300 */
      
      /* Leaderboards - Success greens (dark to light) */
      --workspace-1: #067647; /* success-800 */
      --workspace-2: #079455; /* success-700 */
      --workspace-3: #17b26a; /* success-600 */
      --workspace-low-1: #75e0a7; /* success-400 */
      --workspace-low-2: #a9efc5; /* success-300 */
      
      /* Activity - Multicolor using new palette */
      --activity-1: #e6f8ff; /* main-100 */
      --activity-1-icon: #468af1; /* main-500 */
      --activity-2: #ecfdf3; /* success-100 */
      --activity-2-icon: #17b26a; /* success-600 */
      --activity-3: #f5f3ff; /* accent-100 */
      --activity-3-icon: #7839ee; /* accent-700 */
      --activity-4: #fff8eb; /* warning-100 */
      --activity-4-icon: #f79009; /* warning-600 */
    }
    
    
    /* Donut Chart Hover Styles */
    .donut-container {
      position: relative;
    }
    .donut-segment {
      cursor: pointer;
      transition: opacity 0.15s ease, stroke-width 0.15s ease;
    }
    .donut-segment:hover {
      stroke-width: 8;
    }
    .donut-container:has(.donut-segment:hover) .donut-segment:not(:hover) {
      opacity: 0.4;
    }
    .donut-tooltip {
      position: absolute;
      background: white;
      color: #374151;
      padding: 6px 12px;
      border-radius: 8px;
      font-size: 13px;
      font-weight: 500;
      pointer-events: none;
      opacity: 0;
      transition: opacity 0.15s ease;
      white-space: nowrap;
      z-index: 10;
      transform: translate(-50%, -100%);
      margin-top: -12px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
      border: 1px solid #E5E7EB;
    }
    .donut-tooltip.visible {
      opacity: 1;
    }
  </style>
</head>
<body class="font-sans">
  <!-- SVG Gradient Definition for AI icon -->
  <svg width="0" height="0" class="hidden">
    <defs>
      <linearGradient id="ai-gradient" x1="0%" y1="0%" x2="100%" y2="0%">
        <stop offset="0%" style="stop-color:#8B5CF6"/>
        <stop offset="100%" style="stop-color:#3B82F6"/>
      </linearGradient>
    </defs>
  </svg>

  <!-- Bottom Footer Bar -->
  <div class="fixed bottom-0 left-0 right-0 h-12 bg-neutral-800 flex items-center justify-between px-6 z-40">
    <a href="index.html" class="flex items-center gap-2 text-neutral-400 hover:text-white text-sm">
      <i data-lucide="arrow-left" class="w-4 h-4"></i> All Prototypes
    </a>
    <p class="text-sm text-neutral-400">Folder Dashboard — First Time Experience</p>
    <div class="flex items-center gap-4">
      <div class="flex items-center gap-2 bg-neutral-700 rounded-lg px-3 py-1.5">
        <span class="text-xs text-neutral-400">data=</span>
        <button id="toggle-empty" onclick="setDataMode('empty')" class="px-2.5 py-1 text-xs rounded text-neutral-400 hover:text-white">empty</button>
        <button id="toggle-filled" onclick="setDataMode('filled')" class="px-2.5 py-1 text-xs rounded bg-neutral-600 text-white">filled</button>
      </div>
      <a href="teams-signup-flow.html" onclick="sessionStorage.clear()" class="flex items-center gap-2 text-neutral-400 hover:text-white text-sm">
        <i data-lucide="rotate-ccw" class="w-4 h-4"></i> Reset
      </a>
    </div>
  </div>

  <!-- TOP BAR -->
  <header class="fixed top-0 left-0 right-0 h-16 bg-white border-b border-neutral-100 flex items-center px-6 z-50">
    <!-- Logo -->
    <div class="flex items-center">
      <img src="assets/ctctLogo.png" alt="Constant Contact" class="w-8 h-8 object-contain">
    </div>

    <!-- Center - Search and Create -->
    <div class="flex items-center gap-3 mx-auto">
      <div class="relative">
        <input type="text" id="topbar-search-input" placeholder="Search" onkeydown="handleTopbarSearchKeydown(event)" class="w-48 pl-4 pr-10 py-2 border border-neutral-200 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-ctct-blue focus:border-transparent">
        <i data-lucide="search" class="w-4 h-4 text-neutral-400 absolute right-3 top-1/2 -translate-y-1/2"></i>
      </div>
      <button onclick="openQuickActionsDialog()" class="px-6 py-2 bg-ctct-blue hover:opacity-90 text-white rounded-lg font-medium text-sm">
        Create
      </button>
    </div>

    <!-- Right side -->
    <div class="flex items-center gap-3">
      <button class="flex items-center gap-2 px-4 py-2 hover:bg-main-50 rounded-full text-sm">
        <svg class="w-4 h-4" viewBox="0 0 24 24" fill="none" stroke="url(#ai-gradient)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z"/>
          <path d="M5 3v4"/><path d="M19 17v4"/><path d="M3 5h4"/><path d="M17 19h4"/>
        </svg>
        <span class="font-medium ai-gradient-text">AI assistant</span>
      </button>
      
      <button class="flex items-center gap-2 px-2 py-1 hover:bg-neutral-50 rounded-lg text-sm">
        <div class="w-6 h-6 bg-warning-900 rounded flex items-center justify-center">
          <span class="text-warning-400 text-xs font-bold">u</span>
        </div>
        <span class="text-neutral-700" id="enterprise-name">UPS Global</span>
        <i data-lucide="chevron-down" class="w-4 h-4 text-neutral-400"></i>
      </button>
      
      <button class="p-2 text-neutral-400 hover:text-neutral-600">
        <i data-lucide="help-circle" class="w-5 h-5"></i>
      </button>
    </div>
  </header>

  <div class="flex h-screen pt-16 pb-10">
    <!-- Left Sidebar -->
    <aside class="w-64 bg-white flex flex-col pt-3">
      <!-- Navigation -->
      <div class="flex-1 overflow-y-auto px-3">
        <nav>
          <!-- Org dashboard - Active -->
          <a href="option-b-northstar-empty.html" class="block py-3 px-4 text-sm font-semibold text-neutral-700 bg-main-50 rounded-xl mb-1">Org dashboard</a>

          <!-- Workspaces -->
          <a href="workspaces-list.html" class="block py-3 px-4 text-sm text-neutral-600 hover:bg-main-50 rounded-xl mb-1 transition-colors">Workspaces</a>

          <!-- Campaign approval -->
          <a href="campaign-approval.html" class="block py-3 px-4 text-sm text-neutral-600 hover:bg-main-50 rounded-xl mb-1 transition-colors">Campaign approval</a>

          <!-- Central send -->
          <a href="#" class="block py-3 px-4 text-sm text-neutral-600 hover:bg-main-50 rounded-xl mb-1 transition-colors">Central send</a>

          <!-- Reporting (expandable) -->
          <div class="mb-1">
            <button onclick="toggleSection('reporting')" class="w-full flex items-center justify-between py-3 px-4 text-sm text-neutral-600 hover:bg-main-50 rounded-xl transition-colors focus:outline-none">
              <span>Reporting</span>
              <svg class="w-4 h-4 text-neutral-400" id="reporting-chevron" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 15l7-7 7 7"></path></svg>
            </button>
            <div id="reporting-items" class="ml-4 mt-1">
              <a href="#" class="block py-2.5 px-4 text-sm text-neutral-500 hover:bg-main-50 rounded-xl transition-colors">Campaign engagement</a>
              <a href="#" class="block py-2.5 px-4 text-sm text-neutral-500 hover:bg-main-50 rounded-xl transition-colors">Brand asset usage</a>
              <a href="#" class="block py-2.5 px-4 text-sm text-neutral-500 hover:bg-main-50 rounded-xl transition-colors">Activity log</a>
            </div>
          </div>

          <!-- Assets (expandable) -->
          <div class="mb-1">
            <button onclick="toggleSection('assets')" class="w-full flex items-center justify-between py-3 px-4 text-sm text-neutral-600 hover:bg-main-50 rounded-xl transition-colors focus:outline-none">
              <span>Assets</span>
              <svg class="w-4 h-4 text-neutral-400" id="assets-chevron" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 15l7-7 7 7"></path></svg>
            </button>
            <div id="assets-items" class="ml-4 mt-1">
              <a href="#" class="block py-2.5 px-4 text-sm text-neutral-500 hover:bg-main-50 rounded-xl transition-colors">Templates</a>
              <a href="#" class="block py-2.5 px-4 text-sm text-neutral-500 hover:bg-main-50 rounded-xl transition-colors">Brandkit</a>
              <a href="#" class="block py-2.5 px-4 text-sm text-neutral-500 hover:bg-main-50 rounded-xl transition-colors">Image library</a>
            </div>
          </div>

          <!-- Community -->
          <a href="#" class="block py-3 px-4 text-sm text-neutral-600 hover:bg-main-50 rounded-xl mb-1 transition-colors">Community</a>

          <!-- Billing & settings -->
          <a href="#" class="block py-3 px-4 text-sm text-neutral-600 hover:bg-main-50 rounded-xl transition-colors">Billing & settings</a>
        </nav>
      </div>
    </aside>

    <!-- Main Content -->
    <main class="flex-1 overflow-y-auto px-8 py-6">
      <div class="max-w-6xl">
        <!-- Header -->
        <div class="flex items-center justify-between mb-8">
          <div>
            <h1 class="text-2xl font-bold text-neutral-900 mb-1" id="folder-title">Org dashboard</h1>
            <p class="text-neutral-500">Stats date-range is this month. Each widget can be configured individually.</p>
        </div>
          <button onclick="openAddWidgetModal()" class="flex items-center gap-2 px-4 py-2.5 text-sm font-medium text-neutral-600 hover:text-neutral-800 bg-white border border-neutral-200 rounded-xl hover:border-neutral-300 transition-colors shadow-sm">
            <i data-lucide="plus" class="w-4 h-4"></i>
            Add widget
            </button>
        </div>

        <!-- Dashboard Grid -->
        <div class="grid gap-5" style="grid-template-columns: 1fr 1fr 1.25fr">
          <!-- Left Column -->
          <div class="space-y-5">
            <!-- Email Engagement -->
            <div class="bg-white rounded-2xl border border-neutral-100 p-5 shadow-sm widget-card group/widget" data-widget-id="email-engagement">
              <div class="flex items-center justify-between mb-5">
                <h3 class="text-sm text-neutral-500">Email engagement</h3>
                <div class="relative">
                  <button onclick="toggleWidgetMenu(event, 'email-engagement')" class="p-1 text-neutral-400 hover:text-neutral-600">
                    <i data-lucide="more-vertical" class="w-4 h-4"></i>
                  </button>
                  <div id="widget-menu-email-engagement" class="hidden absolute right-0 top-full mt-1 bg-white rounded-lg shadow-lg border border-neutral-100 py-1 z-20 min-w-[140px]">
                    <button onclick="openCustomizeWidget('email-engagement')" class="w-full flex items-center gap-2 px-3 py-2 text-sm text-neutral-700 hover:bg-neutral-50">
                      <i data-lucide="settings-2" class="w-4 h-4"></i>
                      Customize
                    </button>
                    <a href="folder-reporting.html?channel=email" class="w-full flex items-center gap-2 px-3 py-2 text-sm text-neutral-700 hover:bg-neutral-50">
                      <i data-lucide="bar-chart-2" class="w-4 h-4"></i>
                      View full report
                    </a>
                  </div>
                </div>
              </div>
              <div class="grid grid-cols-2 gap-x-8 gap-y-6">
                <div>
                  <div class="flex items-baseline gap-2">
                    <p id="metric-sends" class="text-2xl font-normal text-neutral-900">1260</p>
                    <i data-lucide="arrow-up" class="w-4 h-4 text-success-600"></i>
                  </div>
                  <p class="text-sm text-neutral-500 mt-0.5">Sends</p>
                </div>
                <div>
                  <div class="flex items-baseline gap-2">
                    <p id="metric-opens" class="text-2xl font-normal text-neutral-900">460</p>
                    <i data-lucide="arrow-up" class="w-4 h-4 text-success-600"></i>
                  </div>
                  <p class="text-sm text-neutral-500 mt-0.5">Opens</p>
                </div>
                <div>
                  <div class="flex items-baseline gap-2">
                    <p id="metric-clicks" class="text-2xl font-normal text-neutral-900">432</p>
                    <i data-lucide="arrow-up" class="w-4 h-4 text-success-600"></i>
                  </div>
                  <p class="text-sm text-neutral-500 mt-0.5">Clicks</p>
                </div>
                <div>
                  <div class="flex items-baseline gap-2">
                    <p id="metric-bounces" class="text-2xl font-normal text-neutral-900">32</p>
                    <i data-lucide="arrow-down" class="w-4 h-4 text-danger-400"></i>
                  </div>
                  <p class="text-sm text-neutral-500 mt-0.5">Bounces</p>
                </div>
              </div>
            </div>

            <!-- Social Engagement -->
            <div class="bg-white rounded-2xl border border-neutral-100 p-5 shadow-sm widget-card group/widget" data-widget-id="social-engagement">
              <div class="flex items-center justify-between mb-5">
                <h3 class="text-sm text-neutral-500">Social engagement</h3>
                <div class="relative">
                  <button onclick="toggleWidgetMenu(event, 'social-engagement')" class="p-1 text-neutral-400 hover:text-neutral-600">
                    <i data-lucide="more-vertical" class="w-4 h-4"></i>
                  </button>
                  <div id="widget-menu-social-engagement" class="hidden absolute right-0 top-full mt-1 bg-white rounded-lg shadow-lg border border-neutral-100 py-1 z-20 min-w-[140px]">
                    <button onclick="openCustomizeWidget('social-engagement')" class="w-full flex items-center gap-2 px-3 py-2 text-sm text-neutral-700 hover:bg-neutral-50">
                      <i data-lucide="settings-2" class="w-4 h-4"></i>
                      Customize
                    </button>
                    <a href="folder-reporting.html?channel=social" class="w-full flex items-center gap-2 px-3 py-2 text-sm text-neutral-700 hover:bg-neutral-50">
                      <i data-lucide="bar-chart-2" class="w-4 h-4"></i>
                      View full report
                    </a>
                  </div>
                </div>
              </div>
              <div class="grid grid-cols-2 gap-x-8 gap-y-4">
                <div>
                  <div class="flex items-baseline gap-2">
                    <p id="metric-views" class="text-2xl font-normal text-neutral-900">1260</p>
                    <i data-lucide="arrow-up" class="w-4 h-4 text-success-600"></i>
                  </div>
                  <p class="text-sm text-neutral-500 mt-0.5">Views</p>
                </div>
                <div>
                  <div class="flex items-baseline gap-2">
                    <p id="metric-likes" class="text-2xl font-normal text-neutral-900">460</p>
                    <i data-lucide="arrow-up" class="w-4 h-4 text-success-600"></i>
                  </div>
                  <p class="text-sm text-neutral-500 mt-0.5">Likes</p>
                </div>
              </div>
            </div>

            <!-- Top Performing Workspaces -->
            <div class="bg-white rounded-2xl border border-neutral-100 p-5 shadow-sm">
              <div class="flex items-center justify-between mb-5">
                <h3 class="text-sm text-neutral-500">Top performing workspaces</h3>
                <div class="relative">
                  <button onclick="toggleDropdown('top-metric-dropdown')" class="flex items-center gap-1 text-xs text-neutral-400 hover:text-neutral-600 transition-colors">
                    <span id="top-metric-label">Campaigns sent</span>
                    <i data-lucide="chevron-down" class="w-3 h-3"></i>
                  </button>
                  <div id="top-metric-dropdown" class="hidden absolute right-0 top-full mt-1 bg-white rounded-lg shadow-lg border border-neutral-100 py-1 z-10 min-w-[140px]">
                    <button onclick="selectMetric('top', 'campaigns', 'Campaigns sent')" class="w-full flex items-center justify-between px-3 py-2 text-sm text-neutral-700 hover:bg-neutral-50">
                      <span>Campaigns sent</span>
                      <i data-lucide="check" class="w-4 h-4 text-main-500 metric-check" data-metric="campaigns"></i>
                    </button>
                    <button onclick="selectMetric('top', 'contacts', 'Contact growth')" class="w-full flex items-center justify-between px-3 py-2 text-sm text-neutral-700 hover:bg-neutral-50">
                      <span>Contact growth</span>
                      <i data-lucide="check" class="w-4 h-4 text-main-500 metric-check hidden" data-metric="contacts"></i>
                    </button>
                  </div>
                </div>
              </div>
              <div id="top-workspaces" class="space-y-4">
                <!-- Workspace 1 -->
                <a href="workspace-detail.html?id=nj" class="flex items-center gap-3 group hover:bg-neutral-50 -mx-2 px-2 py-1 rounded-lg transition-colors cursor-pointer">
                  <div class="flex items-center gap-2 w-28 flex-shrink-0">
                    <div class="w-2 h-2 rounded-full flex-shrink-0" style="background: var(--workspace-1)"></div>
                    <span class="text-sm text-neutral-700 truncate group-hover:text-neutral-900">NJ Location</span>
                  </div>
                  <div class="flex-1 h-1.5 bg-neutral-100 rounded-full relative">
                    <div class="absolute left-0 top-0 h-full rounded-full transition-all" style="width: 80%; background: var(--workspace-1)"></div>
                    <span class="absolute right-0 top-1/2 -translate-y-1/2 px-2 py-0.5 bg-neutral-800 text-white text-xs rounded opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none" style="transform: translateY(-50%) translateX(0)">80%</span>
                  </div>
                </a>
                <!-- Workspace 2 -->
                <a href="workspace-detail.html?id=ny" class="flex items-center gap-3 group hover:bg-neutral-50 -mx-2 px-2 py-1 rounded-lg transition-colors cursor-pointer">
                  <div class="flex items-center gap-2 w-28 flex-shrink-0">
                    <div class="w-2 h-2 rounded-full flex-shrink-0" style="background: var(--workspace-2)"></div>
                    <span class="text-sm text-neutral-700 truncate group-hover:text-neutral-900">NY Location</span>
                  </div>
                  <div class="flex-1 h-1.5 bg-neutral-100 rounded-full relative">
                    <div class="absolute left-0 top-0 h-full rounded-full transition-all" style="width: 60%; background: var(--workspace-2)"></div>
                    <span class="absolute right-0 top-1/2 -translate-y-1/2 px-2 py-0.5 bg-neutral-800 text-white text-xs rounded opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none">60%</span>
                  </div>
                </a>
                <!-- Workspace 3 -->
                <a href="workspace-detail.html?id=ct" class="flex items-center gap-3 group hover:bg-neutral-50 -mx-2 px-2 py-1 rounded-lg transition-colors cursor-pointer">
                  <div class="flex items-center gap-2 w-28 flex-shrink-0">
                    <div class="w-2 h-2 rounded-full flex-shrink-0" style="background: var(--workspace-3)"></div>
                    <span class="text-sm text-neutral-700 truncate group-hover:text-neutral-900">CT Location</span>
                  </div>
                  <div class="flex-1 h-1.5 bg-neutral-100 rounded-full relative">
                    <div class="absolute left-0 top-0 h-full rounded-full transition-all" style="width: 40%; background: var(--workspace-3)"></div>
                    <span class="absolute right-0 top-1/2 -translate-y-1/2 px-2 py-0.5 bg-neutral-800 text-white text-xs rounded opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none">40%</span>
                  </div>
                </a>
              </div>
            </div>
          </div>

          <!-- Middle Column -->
          <div class="space-y-5">
            <!-- Contact Growth -->
            <div class="bg-white rounded-2xl border border-neutral-100 p-5 shadow-sm widget-card group/widget" data-widget-id="contact-growth">
              <div class="flex items-center justify-between mb-3">
                <h3 class="text-sm text-neutral-500">Contact growth</h3>
                <div class="relative">
                  <button onclick="toggleWidgetMenu(event, 'contact-growth')" class="p-1 text-neutral-400 hover:text-neutral-600">
                    <i data-lucide="more-vertical" class="w-4 h-4"></i>
                  </button>
                  <div id="widget-menu-contact-growth" class="hidden absolute right-0 top-full mt-1 bg-white rounded-lg shadow-lg border border-neutral-100 py-1 z-20 min-w-[140px]">
                    <button onclick="openCustomizeWidget('contact-growth')" class="w-full flex items-center gap-2 px-3 py-2 text-sm text-neutral-700 hover:bg-neutral-50">
                      <i data-lucide="settings-2" class="w-4 h-4"></i>
                      Customize
                    </button>
                    <a href="folder-reporting.html?channel=contacts" class="w-full flex items-center gap-2 px-3 py-2 text-sm text-neutral-700 hover:bg-neutral-50">
                      <i data-lucide="bar-chart-2" class="w-4 h-4"></i>
                      View full report
                    </a>
                  </div>
                </div>
              </div>
              <div class="flex items-baseline justify-center gap-2 py-2">
                <p id="metric-contacts" class="text-4xl font-normal text-neutral-900">1,321</p>
                <i data-lucide="arrow-up" class="w-5 h-5 text-success-600"></i>
              </div>
            </div>

            <!-- Email Template Usage - Thin Donut -->
            <div class="bg-white rounded-2xl border border-neutral-100 p-5 shadow-sm widget-card group/widget" data-widget-id="template-usage">
              <div class="flex items-center justify-between mb-3">
                <h3 class="text-sm text-neutral-500">Email template usage</h3>
                <div class="relative">
                  <button onclick="toggleWidgetMenu(event, 'template-usage')" class="p-1 text-neutral-400 hover:text-neutral-600">
                    <i data-lucide="more-vertical" class="w-4 h-4"></i>
                  </button>
                  <div id="widget-menu-template-usage" class="hidden absolute right-0 top-full mt-1 bg-white rounded-lg shadow-lg border border-neutral-100 py-1 z-20 min-w-[140px]">
                    <button onclick="openCustomizeWidget('template-usage')" class="w-full flex items-center gap-2 px-3 py-2 text-sm text-neutral-700 hover:bg-neutral-50">
                      <i data-lucide="settings-2" class="w-4 h-4"></i>
                      Customize
                    </button>
                    <a href="folder-reporting.html?channel=templates" class="w-full flex items-center gap-2 px-3 py-2 text-sm text-neutral-700 hover:bg-neutral-50">
                      <i data-lucide="bar-chart-2" class="w-4 h-4"></i>
                      View full report
                    </a>
                  </div>
                </div>
              </div>
              <div class="flex items-center justify-center py-3">
                <div class="donut-container relative">
                  <!-- Tooltip -->
                  <div id="donut-tooltip" class="donut-tooltip"></div>
                  <!-- SVG Thin Donut Chart with rounded segment ends and gaps -->
                  <svg id="template-donut-svg" width="140" height="140" viewBox="0 0 120 120">
                    <!-- Background circle -->
                    <circle cx="60" cy="60" r="50" fill="none" stroke="#F3F4F6" stroke-width="10"/>
                    <!-- Segment 1 - Newsletter 35% (12 templates) -->
                    <circle class="donut-segment" data-index="0" data-label="Newsletter" data-value="12" data-percent="35" 
                      cx="60" cy="60" r="50" fill="none" stroke="var(--donut-1)" stroke-width="10" 
                      stroke-dasharray="85 229" stroke-dashoffset="0" stroke-linecap="round"
                      transform="rotate(-85 60 60)"/>
                    <!-- Segment 2 - Promo 20% (7 templates) -->
                    <circle class="donut-segment" data-index="1" data-label="Promo" data-value="7" data-percent="20" 
                      cx="60" cy="60" r="50" fill="none" stroke="var(--donut-2)" stroke-width="10" 
                      stroke-dasharray="42 272" stroke-dashoffset="0" stroke-linecap="round"
                      transform="rotate(25 60 60)"/>
                    <!-- Segment 3 - Welcome 20% (7 templates) -->
                    <circle class="donut-segment" data-index="2" data-label="Welcome" data-value="7" data-percent="20" 
                      cx="60" cy="60" r="50" fill="none" stroke="var(--donut-3)" stroke-width="10" 
                      stroke-dasharray="42 272" stroke-dashoffset="0" stroke-linecap="round"
                      transform="rotate(90 60 60)"/>
                    <!-- Segment 4 - Event 25% (8 templates) -->
                    <circle class="donut-segment" data-index="3" data-label="Event" data-value="8" data-percent="25" 
                      cx="60" cy="60" r="50" fill="none" stroke="var(--donut-4)" stroke-width="10" 
                      stroke-dasharray="55 259" stroke-dashoffset="0" stroke-linecap="round"
                      transform="rotate(155 60 60)"/>
                  </svg>
                  <!-- Center number -->
                  <div class="absolute inset-0 flex items-center justify-center pointer-events-none">
                    <span id="metric-templates" class="text-3xl font-normal text-neutral-900">34</span>
                  </div>
                </div>
              </div>
            </div>

            <!-- Low Performing Workspaces -->
            <div class="bg-white rounded-2xl border border-neutral-100 p-5 shadow-sm">
              <div class="flex items-center justify-between mb-5">
                <h3 class="text-sm text-neutral-500">Low performing workspaces</h3>
                <div class="relative">
                  <button onclick="toggleDropdown('low-metric-dropdown')" class="flex items-center gap-1 text-xs text-neutral-400 hover:text-neutral-600 transition-colors">
                    <span id="low-metric-label">Campaigns sent</span>
                    <i data-lucide="chevron-down" class="w-3 h-3"></i>
                  </button>
                  <div id="low-metric-dropdown" class="hidden absolute right-0 top-full mt-1 bg-white rounded-lg shadow-lg border border-neutral-100 py-1 z-10 min-w-[140px]">
                    <button onclick="selectMetric('low', 'campaigns', 'Campaigns sent')" class="w-full flex items-center justify-between px-3 py-2 text-sm text-neutral-700 hover:bg-neutral-50">
                      <span>Campaigns sent</span>
                      <i data-lucide="check" class="w-4 h-4 text-main-500 metric-check-low" data-metric="campaigns"></i>
                    </button>
                    <button onclick="selectMetric('low', 'contacts', 'Contact growth')" class="w-full flex items-center justify-between px-3 py-2 text-sm text-neutral-700 hover:bg-neutral-50">
                      <span>Contact growth</span>
                      <i data-lucide="check" class="w-4 h-4 text-main-500 metric-check-low hidden" data-metric="contacts"></i>
                    </button>
                  </div>
                </div>
              </div>
              <div id="low-workspaces" class="space-y-4">
                <!-- Workspace 1 -->
                <a href="workspace-detail.html?id=ma" class="flex items-center gap-3 group hover:bg-neutral-50 -mx-2 px-2 py-1 rounded-lg transition-colors cursor-pointer">
                  <div class="flex items-center gap-2 w-28 flex-shrink-0">
                    <div class="w-2 h-2 rounded-full flex-shrink-0" style="background: var(--workspace-low-1)"></div>
                    <span class="text-sm text-neutral-700 truncate group-hover:text-neutral-900">MA Location</span>
                  </div>
                  <div class="flex-1 h-1.5 bg-neutral-100 rounded-full relative">
                    <div class="absolute left-0 top-0 h-full rounded-full transition-all" style="width: 8%; min-width: 6px; background: var(--workspace-low-1)"></div>
                    <span class="absolute right-0 top-1/2 -translate-y-1/2 px-2 py-0.5 bg-neutral-800 text-white text-xs rounded opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none">8%</span>
                  </div>
                </a>
                <!-- Workspace 2 -->
                <a href="workspace-detail.html?id=ri" class="flex items-center gap-3 group hover:bg-neutral-50 -mx-2 px-2 py-1 rounded-lg transition-colors cursor-pointer">
                  <div class="flex items-center gap-2 w-28 flex-shrink-0">
                    <div class="w-2 h-2 rounded-full flex-shrink-0" style="background: var(--workspace-low-2)"></div>
                    <span class="text-sm text-neutral-700 truncate group-hover:text-neutral-900">RI Location</span>
                  </div>
                  <div class="flex-1 h-1.5 bg-neutral-100 rounded-full relative">
                    <div class="absolute left-0 top-0 h-full rounded-full transition-all" style="width: 4%; min-width: 6px; background: var(--workspace-low-2)"></div>
                    <span class="absolute right-0 top-1/2 -translate-y-1/2 px-2 py-0.5 bg-neutral-800 text-white text-xs rounded opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none">4%</span>
                  </div>
                </a>
              </div>
            </div>
          </div>

          <!-- Right Column - Recent Activity -->
          <div class="bg-white rounded-2xl border border-neutral-100 p-5 shadow-sm widget-card group/widget" data-widget-id="recent-activity">
            <div class="flex items-center justify-between mb-4">
              <h3 class="text-sm text-neutral-500">Recent activity</h3>
              <div class="relative">
                <button onclick="toggleActivityFilter(event)" class="flex items-center gap-1.5 px-2 py-1.5 text-neutral-400 hover:text-neutral-600 hover:bg-neutral-50 rounded-lg transition-colors">
                  <i data-lucide="list-filter" class="w-4 h-4"></i>
                </button>
                <div id="activity-filter-menu" class="hidden absolute right-0 top-full mt-1 bg-white rounded-xl shadow-lg border border-neutral-100 py-1.5 z-20 min-w-[130px]">
                  <button onclick="filterActivity('all')" class="w-full text-left px-3 py-2 text-sm text-neutral-700 hover:bg-neutral-50">
                    All activity
                  </button>
                  <button onclick="filterActivity('approvals')" class="w-full text-left px-3 py-2 text-sm text-neutral-700 hover:bg-neutral-50">
                    Approvals
                  </button>
                  <button onclick="filterActivity('campaigns')" class="w-full text-left px-3 py-2 text-sm text-neutral-700 hover:bg-neutral-50">
                    Campaigns
                  </button>
                  <button onclick="filterActivity('workspaces')" class="w-full text-left px-3 py-2 text-sm text-neutral-700 hover:bg-neutral-50">
                    Workspaces
                  </button>
                </div>
              </div>
            </div>
            <div id="recent-activity" class="space-y-3">
              <!-- Pending Approval Request 1 -->
              <a href="campaign-approval.html" data-type="approvals" class="block bg-white rounded-xl p-4 shadow-sm border border-neutral-100 hover:shadow-md transition-shadow group cursor-pointer relative">
                <div class="absolute top-3 right-3 w-2.5 h-2.5 bg-warning-400 rounded-full"></div>
                <div class="flex items-center gap-4">
                  <img src="assets/email1.png" alt="Campaign preview" class="w-16 h-16 rounded-lg object-cover flex-shrink-0 border border-neutral-100">
                  <div class="flex-1 min-w-0">
                    <p class="text-sm font-medium text-neutral-600 mb-1.5">Campaign approval request</p>
                    <div class="flex items-center gap-2">
                      <div class="w-5 h-5 bg-accent-500 rounded-full flex items-center justify-center text-white text-[9px] font-bold flex-shrink-0">GE</div>
                      <span class="text-xs text-neutral-500">UPS Greenwich</span>
                      <span class="text-xs text-neutral-400 ml-auto">5 m ago</span>
                    </div>
                  </div>
                </div>
              </a>
              
              <!-- Pending Approval Request 2 -->
              <a href="campaign-approval.html" data-type="approvals" class="block bg-white rounded-xl p-4 shadow-sm border border-neutral-100 hover:shadow-md transition-shadow group cursor-pointer relative">
                <div class="absolute top-3 right-3 w-2.5 h-2.5 bg-warning-400 rounded-full"></div>
                <div class="flex items-center gap-4">
                  <img src="assets/email2.png" alt="Campaign preview" class="w-16 h-16 rounded-lg object-cover flex-shrink-0 border border-neutral-100">
                  <div class="flex-1 min-w-0">
                    <p class="text-sm font-medium text-neutral-600 mb-1.5">Campaign approval request</p>
                    <div class="flex items-center gap-2">
                      <div class="w-5 h-5 bg-accent-500 rounded-full flex items-center justify-center text-white text-[9px] font-bold flex-shrink-0">GE</div>
                      <span class="text-xs text-neutral-500">UPS Greenwich</span>
                      <span class="text-xs text-neutral-400 ml-auto">1 hr ago</span>
                    </div>
                  </div>
                </div>
              </a>
              
              <!-- New Workspace Created -->
              <a href="workspace-detail.html?workspace=GE%20Workspace" data-type="workspaces" class="block bg-white rounded-xl p-4 shadow-sm border border-neutral-100 hover:shadow-md transition-shadow group cursor-pointer">
                <div class="flex items-center gap-4">
                  <div class="w-16 h-16 rounded-full bg-main-100 flex items-center justify-center flex-shrink-0">
                    <i data-lucide="shapes" class="w-6 h-6 text-main-600"></i>
                  </div>
                  <div class="flex-1 min-w-0">
                    <p class="text-sm font-medium text-neutral-600 mb-1.5">New GE workspace created</p>
                    <div class="flex items-center gap-2">
                      <div class="w-5 h-5 bg-success-600 rounded-full flex items-center justify-center text-white text-[9px] font-bold flex-shrink-0">GL</div>
                      <span class="text-xs text-neutral-500">UPS Global</span>
                      <span class="text-xs text-neutral-400 ml-auto">1 day ago</span>
                    </div>
                  </div>
                </div>
              </a>
              
              <!-- Email Campaign Scheduled -->
              <a href="campaigns-list.html?workspace=UPS%20Northeast" data-type="campaigns" class="block bg-white rounded-xl p-4 shadow-sm border border-neutral-100 hover:shadow-md transition-shadow group cursor-pointer">
                <div class="flex items-center gap-4">
                  <img src="assets/email3.png" alt="Campaign preview" class="w-16 h-16 rounded-lg object-cover flex-shrink-0 border border-neutral-100">
                  <div class="flex-1 min-w-0">
                    <p class="text-sm font-medium text-neutral-600 mb-1.5">Email campaign scheduled</p>
                    <div class="flex items-center gap-2">
                      <div class="w-5 h-5 bg-main-500 rounded-full flex items-center justify-center text-white text-[9px] font-bold flex-shrink-0">NE</div>
                      <span class="text-xs text-neutral-500">UPS NE Region</span>
                      <span class="text-xs text-neutral-400 ml-auto">2 days ago</span>
                    </div>
                  </div>
                </div>
              </a>
              
              <!-- Email Campaign Sent -->
              <a href="report-clickthrough.html" data-type="campaigns" class="block bg-white rounded-xl p-4 shadow-sm border border-neutral-100 hover:shadow-md transition-shadow group cursor-pointer">
                <div class="flex items-center gap-4">
                  <img src="assets/email4.png" alt="Campaign preview" class="w-16 h-16 rounded-lg object-cover flex-shrink-0 border border-neutral-100">
                  <div class="flex-1 min-w-0">
                    <p class="text-sm font-medium text-neutral-600 mb-1.5">Email campaign sent</p>
                    <div class="flex items-center gap-2">
                      <div class="w-5 h-5 bg-main-500 rounded-full flex items-center justify-center text-white text-[9px] font-bold flex-shrink-0">NE</div>
                      <span class="text-xs text-neutral-500">UPS NE Region</span>
                      <span class="text-xs text-neutral-400 ml-auto">3 days ago</span>
                    </div>
                  </div>
                </div>
              </a>
            </div>
          </div>
        </div>
        
      </div>
    </main>
  </div>

  <!-- Customize Widget Modal -->
  <div id="customize-widget-modal" class="fixed inset-0 z-[100] hidden">
    <!-- Backdrop -->
    <div class="absolute inset-0 bg-black/50 backdrop-blur-sm" onclick="closeCustomizeWidgetModal()"></div>
    
    <!-- Modal Content -->
    <div class="absolute inset-0 flex items-center justify-center p-8">
      <div class="bg-white rounded-2xl shadow-2xl w-full max-w-4xl max-h-[90vh] overflow-hidden flex flex-col">
        <!-- Header -->
        <div class="flex items-center justify-between px-6 py-4 border-b border-neutral-100">
          <h2 class="text-lg font-semibold text-neutral-900">Customize widget</h2>
          <button onclick="closeCustomizeWidgetModal()" class="text-neutral-400 hover:text-neutral-600 transition-colors">
            <i data-lucide="x" class="w-5 h-5"></i>
          </button>
        </div>
        
        <!-- Body -->
        <div class="flex flex-1 overflow-hidden">
          <!-- Left - Configuration -->
          <div class="flex-1 p-6 overflow-y-auto border-r border-neutral-100">
            <div class="space-y-6">
              <!-- Chart Type & Channel -->
              <div class="grid grid-cols-2 gap-4">
                <div>
                  <label class="block text-sm font-medium text-neutral-700 mb-2">Chart type</label>
                  <div class="relative">
                    <select id="widget-chart-type" onchange="updateStatsSelectionUI()" class="w-full px-3 py-2.5 border border-neutral-200 rounded-lg text-sm appearance-none bg-white focus:outline-none focus:ring-2 focus:ring-main-500 focus:border-transparent">
                      <option value="1-stat">1 stat</option>
                      <option value="2-stats">2 stats</option>
                      <option value="4-stats">4 stats</option>
                      <option value="bar">Bar</option>
                      <option value="donut">Donut</option>
                      <option value="line">Line</option>
                      <option value="leaderboard">Leaderboard</option>
                    </select>
                    <i data-lucide="chevron-down" class="w-4 h-4 text-neutral-400 absolute right-3 top-1/2 -translate-y-1/2 pointer-events-none"></i>
                  </div>
                </div>
                <div>
                  <label class="block text-sm font-medium text-neutral-700 mb-2">Channel</label>
                  <div class="relative">
                    <select id="widget-channel" onchange="updateStatsSelectionUI()" class="w-full px-3 py-2.5 border border-neutral-200 rounded-lg text-sm appearance-none bg-white focus:outline-none focus:ring-2 focus:ring-main-500 focus:border-transparent">
                      <option value="email">Email</option>
                      <option value="social">Social</option>
                      <option value="sms">SMS</option>
                      <option value="contacts">Contacts</option>
                    </select>
                    <i data-lucide="chevron-down" class="w-4 h-4 text-neutral-400 absolute right-3 top-1/2 -translate-y-1/2 pointer-events-none"></i>
                  </div>
                </div>
              </div>
              
              <!-- Dynamic Stats Selection Container -->
              <div id="stats-selection-container">
                <!-- This will be dynamically populated based on chart type -->
              </div>
              
              <!-- Show trend arrows -->
              <div class="flex items-center gap-3">
                <input type="checkbox" id="widget-show-trends" checked onchange="updateWidgetPreview()" class="w-5 h-5 rounded border-neutral-300 text-main-500 focus:ring-main-500">
                <label for="widget-show-trends" class="text-sm text-neutral-700">Show trend arrows</label>
              </div>
              
              <!-- Workspaces & Date Range -->
              <div class="grid grid-cols-2 gap-4">
                <div>
                  <label class="block text-sm font-medium text-neutral-700 mb-2">Workspaces</label>
                  <div class="relative">
                    <select id="widget-workspaces" class="w-full px-3 py-2.5 border border-neutral-200 rounded-lg text-sm appearance-none bg-white focus:outline-none focus:ring-2 focus:ring-main-500 focus:border-transparent">
                      <option value="all">All workspaces</option>
                      <option value="ups-greenwich">UPS Greenwich</option>
                      <option value="ups-newyork">UPS New York</option>
                      <option value="ups-newjersey">UPS New Jersey</option>
                    </select>
                    <i data-lucide="chevron-down" class="w-4 h-4 text-neutral-400 absolute right-3 top-1/2 -translate-y-1/2 pointer-events-none"></i>
                  </div>
                </div>
                <div>
                  <label class="block text-sm font-medium text-neutral-700 mb-2">Date-range</label>
                  <div class="relative">
                    <select id="widget-date-range" class="w-full px-3 py-2.5 border border-neutral-200 rounded-lg text-sm appearance-none bg-white focus:outline-none focus:ring-2 focus:ring-main-500 focus:border-transparent">
                      <option value="30-days">30 days</option>
                      <option value="1-week">1 week</option>
                      <option value="6-months">6 months</option>
                      <option value="year-to-date">Year to date</option>
                      <option value="custom">Custom</option>
                    </select>
                    <i data-lucide="chevron-down" class="w-4 h-4 text-neutral-400 absolute right-3 top-1/2 -translate-y-1/2 pointer-events-none"></i>
                  </div>
                </div>
              </div>
            </div>
          </div>
          
          <!-- Right - Preview -->
          <div class="w-80 p-6 bg-neutral-50 flex flex-col">
            <h3 class="text-sm font-medium text-neutral-700 text-center mb-4">Preview</h3>
            <div class="flex-1 flex items-start justify-center">
              <div id="widget-preview" class="bg-white rounded-xl border border-neutral-100 p-4 shadow-sm w-full">
                <!-- Dynamically populated -->
                </div>
                    </div>
                  </div>
                    </div>
        
        <!-- Footer -->
        <div class="flex items-center justify-between px-6 py-4 border-t border-neutral-100">
          <button onclick="openSaveCustomWidgetDialog()" class="flex items-center gap-2 px-4 py-2.5 text-sm font-medium text-neutral-600 hover:text-neutral-800 hover:bg-neutral-50 rounded-lg transition-colors">
            <i data-lucide="bookmark" class="w-4 h-4"></i>
            Save as custom widget
          </button>
          <div class="flex items-center gap-3">
            <button onclick="closeCustomizeWidgetModal()" class="px-5 py-2.5 text-sm font-medium text-neutral-700 hover:bg-neutral-50 rounded-lg transition-colors">
              Cancel
            </button>
            <button onclick="saveWidgetSettings()" class="px-5 py-2.5 bg-main-500 text-white text-sm font-medium rounded-lg hover:bg-main-600 transition-colors">
              Save
            </button>
                  </div>
                    </div>
                  </div>
                    </div>
                  </div>

  <!-- Save Custom Widget Modal -->
  <div id="save-custom-widget-modal" class="fixed inset-0 z-[110] hidden">
    <!-- Backdrop -->
    <div class="absolute inset-0 bg-black/50 backdrop-blur-sm" onclick="closeSaveCustomWidgetDialog()"></div>
    
    <!-- Modal Content -->
    <div class="absolute inset-0 flex items-center justify-center p-8">
      <div class="bg-white rounded-2xl shadow-2xl w-full max-w-md overflow-hidden">
        <!-- Header -->
        <div class="flex items-center justify-between px-6 py-4 border-b border-neutral-100">
          <h2 class="text-lg font-semibold text-neutral-900">Save custom widget</h2>
          <button onclick="closeSaveCustomWidgetDialog()" class="text-neutral-400 hover:text-neutral-600 transition-colors">
            <i data-lucide="x" class="w-5 h-5"></i>
          </button>
                </div>
        
        <!-- Body -->
        <div class="p-6">
          <p class="text-sm text-neutral-600 mb-4">Save this widget configuration to reuse it later across your dashboards.</p>
          
          <div class="space-y-4">
            <div>
              <label class="block text-sm font-medium text-neutral-700 mb-1.5">Widget name</label>
              <input type="text" id="custom-widget-name" placeholder="e.g., Monthly email performance" class="w-full px-4 py-2.5 border border-neutral-200 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-main-500 focus:border-transparent">
              </div>
            
            <div>
              <label class="block text-sm font-medium text-neutral-700 mb-1.5">Description (optional)</label>
              <textarea id="custom-widget-description" placeholder="Describe what this widget shows..." rows="2" class="w-full px-4 py-2.5 border border-neutral-200 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-main-500 focus:border-transparent resize-none"></textarea>
            </div>
          </div>
        </div>
        
        <!-- Footer -->
        <div class="flex items-center justify-end gap-3 px-6 py-4 border-t border-neutral-100">
          <button onclick="closeSaveCustomWidgetDialog()" class="px-5 py-2.5 text-sm font-medium text-neutral-700 hover:bg-neutral-50 rounded-lg transition-colors">
            Cancel
          </button>
          <button onclick="saveCustomWidget()" class="px-5 py-2.5 bg-main-500 text-white text-sm font-medium rounded-lg hover:bg-main-600 transition-colors">
            Save widget
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Approval Review Modal -->
  <div id="approval-modal" class="fixed inset-0 z-[100] hidden">
    <!-- Backdrop -->
    <div class="absolute inset-0 bg-black/50 backdrop-blur-sm" onclick="closeApprovalModal()"></div>
    
    <!-- Modal Content -->
    <div class="absolute inset-0 flex items-center justify-center p-8">
      <div class="bg-white rounded-2xl shadow-2xl w-full max-w-5xl max-h-[90vh] overflow-hidden flex flex-col">
        <!-- Header -->
        <div class="flex items-center justify-between px-6 py-4 border-b border-neutral-100">
          <h2 class="text-lg font-semibold text-neutral-900">Approval Review</h2>
          <button onclick="closeApprovalModal()" class="text-neutral-400 hover:text-neutral-600 transition-colors">
            <i data-lucide="x" class="w-5 h-5"></i>
          </button>
        </div>
        
        <!-- Body -->
        <div class="flex flex-1 overflow-hidden">
          <!-- Left - Email Preview -->
          <div class="flex-1 flex flex-col border-r border-neutral-100">
            <!-- Preview Tabs -->
            <div class="flex gap-6 px-6 pt-4 border-b border-neutral-100">
              <button id="preview-desktop-tab" onclick="switchPreviewTab('desktop')" class="pb-3 text-sm font-medium text-main-600 border-b-2 border-main-600">Desktop</button>
              <button id="preview-mobile-tab" onclick="switchPreviewTab('mobile')" class="pb-3 text-sm font-medium text-neutral-400 hover:text-neutral-600 border-b-2 border-transparent">Mobile</button>
            </div>
            
            <!-- Preview Content -->
            <div class="flex-1 overflow-auto p-6 bg-neutral-50">
              <div id="email-preview-container" class="mx-auto bg-white rounded-lg shadow-sm overflow-hidden" style="max-width: 600px;">
                <!-- Email Preview Content -->
                <div class="bg-gradient-to-b from-success-50 to-white">
                  <!-- Hero Image -->
                  <img src="https://images.unsplash.com/photo-1560518883-ce09059eeffa?w=600&h=300&fit=crop" alt="Neighborhood aerial view" class="w-full h-48 object-cover">
                  
                  <!-- Logo & Content -->
                  <div class="p-8 text-center">
                    <div class="flex items-center justify-center gap-3 mb-4">
                      <div class="w-12 h-12 bg-warning-100 rounded-lg flex items-center justify-center">
                        <i data-lucide="home" class="w-6 h-6 text-warning-600"></i>
                      </div>
                      <div class="text-left">
                        <p class="text-xl font-serif italic text-neutral-800">Green Acres</p>
                        <p class="text-xs tracking-widest text-neutral-500 uppercase">Realty</p>
                      </div>
                    </div>
                    
                    <p class="text-sm text-neutral-600 mb-6 leading-relaxed">
                      Give us a call today to start the search for your first home! Our award-winning team will help you find your first home, in the right location, and within your budget. We can't wait to get started!
                    </p>
                    
                    <button class="bg-danger-500 hover:bg-danger-600 text-white px-6 py-2.5 rounded-lg text-sm font-medium transition-colors">
                      Contact Us
                    </button>
                    
                    <!-- Social Icons -->
                    <div class="flex items-center justify-center gap-4 mt-8 text-neutral-400">
                      <i data-lucide="monitor" class="w-4 h-4"></i>
                      <i data-lucide="mail" class="w-4 h-4"></i>
                      <i data-lucide="linkedin" class="w-4 h-4"></i>
                      <i data-lucide="instagram" class="w-4 h-4"></i>
                      <i data-lucide="music" class="w-4 h-4"></i>
                    </div>
                  </div>
                </div>
                
                <!-- Footer -->
                <div class="px-6 py-4 text-center text-xs text-neutral-400 border-t border-neutral-100">
                  <p>Green Acres Realty - Lexington | 123 main St. | Lexington, MA 02421 US</p>
                  <p class="mt-2">
                    <a href="#" class="underline hover:text-neutral-600">Unsubscribe</a> | 
                    <a href="#" class="underline hover:text-neutral-600">Update Profile</a> | 
                    <a href="#" class="underline hover:text-neutral-600">Constant Contact Data Notice</a>
                  </p>
                  <div class="flex items-center justify-center gap-2 mt-4">
                    <img src="assets/ctctLogo.png" alt="Constant Contact" class="h-6">
                  </div>
                  <p class="text-[10px] text-neutral-300 mt-1">Try email & social marketing for free!</p>
                </div>
              </div>
            </div>
          </div>
          
          <!-- Right - Comments & Actions -->
          <div class="w-80 flex flex-col bg-white">
            <!-- Comments -->
            <div class="flex-1 p-6">
              <div class="flex items-center justify-between mb-2">
                <label class="text-sm font-medium text-neutral-700">Comments</label>
                <span id="comment-count" class="text-xs text-neutral-400">0/400</span>
              </div>
              <textarea 
                id="approval-comment" 
                placeholder="Add a comment..."
                maxlength="400"
                oninput="updateCommentCount()"
                class="w-full h-32 px-3 py-2 text-sm border border-neutral-200 rounded-lg resize-none focus:outline-none focus:ring-2 focus:ring-main-500 focus:border-transparent"
              ></textarea>
              
              <!-- Toggle -->
              <div class="flex items-center justify-between mt-6">
                <span class="text-sm text-neutral-700">Send approve/reject email</span>
                <button id="email-toggle" onclick="toggleEmailNotification()" class="relative w-11 h-6 bg-main-500 rounded-full transition-colors">
                  <span class="absolute right-1 top-1 w-4 h-4 bg-white rounded-full shadow transition-transform"></span>
                </button>
              </div>
            </div>
            
            <!-- Actions -->
            <div class="p-6 border-t border-neutral-100">
              <div class="flex gap-3">
                <button onclick="closeApprovalModal()" class="flex-1 px-4 py-2.5 border border-neutral-200 rounded-lg text-sm font-medium text-neutral-700 hover:bg-neutral-50 transition-colors">
                  Cancel
                </button>
                <button onclick="rejectApproval()" class="flex-1 px-4 py-2.5 bg-danger-500 rounded-lg text-sm font-medium text-white hover:bg-danger-600 transition-colors">
                  Reject
                </button>
                <button onclick="approveApproval()" class="flex-1 px-4 py-2.5 bg-main-500 rounded-lg text-sm font-medium text-white hover:bg-main-600 transition-colors">
                  Approve
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Global Search Dialog -->
  <div id="global-search-dialog" class="fixed inset-0 z-[200] hidden">
    <!-- Backdrop -->
    <div class="absolute inset-0 bg-black/50 backdrop-blur-sm" onclick="closeGlobalSearchDialog()"></div>
    
    <!-- Dialog Content -->
    <div class="absolute inset-0 flex items-start justify-center pt-24">
      <div class="bg-white rounded-2xl shadow-2xl w-full max-w-xl overflow-hidden">
        <!-- Search Input -->
        <div class="flex items-center gap-3 px-5 py-4 border-b border-neutral-100">
          <i data-lucide="search" class="w-5 h-5 text-neutral-400"></i>
          <input type="text" id="global-search-input" placeholder="Type a command or search..." oninput="handleGlobalSearch(this.value)" onkeydown="handleSearchDialogKeydown(event)" class="flex-1 text-base focus:outline-none" autofocus>
          <kbd class="px-2 py-1 text-xs font-medium text-neutral-500 bg-neutral-100 rounded border border-neutral-200">esc</kbd>
        </div>
        
        <!-- Search Results Container -->
        <div id="search-results-container" class="max-h-[450px] overflow-y-auto">
          <!-- Search Results (shown when there's a query) -->
          <div id="search-results-section" class="hidden">
            <!-- Dynamic search results will be populated here -->
          </div>
          
          <!-- Recent Activity Section -->
          <div id="recent-activity-section" class="px-2 pt-3 pb-3">
            <p class="px-3 text-xs font-semibold text-neutral-400 uppercase tracking-wide mb-2">Recently viewed</p>
            <div class="space-y-0.5">
              <!-- Recent Workspaces -->
              <a href="workspace-detail.html?workspace=UPS%20Northeast" class="w-full flex items-center gap-3 px-3 py-2.5 rounded-xl hover:bg-neutral-50 transition-colors">
                <div class="w-10 h-10 bg-success-500 rounded-xl flex items-center justify-center text-white text-sm font-bold">N</div>
                <div class="flex-1 text-left">
                  <p class="text-sm font-medium text-neutral-900">UPS Northeast</p>
                  <p class="text-xs text-neutral-400">Workspace • 2 min ago</p>
                </div>
              </a>
              <!-- Recent Campaign -->
              <a href="#" class="w-full flex items-center gap-3 px-3 py-2.5 rounded-xl hover:bg-neutral-50 transition-colors">
                <div class="w-10 h-10 bg-main-100 rounded-xl flex items-center justify-center">
                  <i data-lucide="send" class="w-5 h-5 text-main-600"></i>
                </div>
                <div class="flex-1 text-left">
                  <p class="text-sm font-medium text-neutral-900">Holiday Shipping Promo</p>
                  <p class="text-xs text-neutral-400">Campaign • UPS Northeast • 15 min ago</p>
                </div>
              </a>
              <!-- Recent List -->
              <a href="contacts-list.html" class="w-full flex items-center gap-3 px-3 py-2.5 rounded-xl hover:bg-neutral-50 transition-colors">
                <div class="w-10 h-10 bg-neutral-100 rounded-xl flex items-center justify-center">
                  <i data-lucide="users" class="w-5 h-5 text-neutral-600"></i>
                </div>
                <div class="flex-1 text-left">
                  <p class="text-sm font-medium text-neutral-900">VIP Customers</p>
                  <p class="text-xs text-neutral-400">Contact list • 2.4k contacts • 1 hr ago</p>
                </div>
              </a>
              <!-- Recent Report -->
              <a href="folder-reporting.html" class="w-full flex items-center gap-3 px-3 py-2.5 rounded-xl hover:bg-neutral-50 transition-colors">
                <div class="w-10 h-10 bg-warning-100 rounded-xl flex items-center justify-center">
                  <i data-lucide="bar-chart-2" class="w-5 h-5 text-warning-600"></i>
                </div>
                <div class="flex-1 text-left">
                  <p class="text-sm font-medium text-neutral-900">Q4 Performance Report</p>
                  <p class="text-xs text-neutral-400">Report • UPS Global • Yesterday</p>
                </div>
              </a>
              <!-- Recent Workspace -->
              <a href="workspace-detail.html?workspace=UPS%20Southwest" class="w-full flex items-center gap-3 px-3 py-2.5 rounded-xl hover:bg-neutral-50 transition-colors">
                <div class="w-10 h-10 bg-warning-500 rounded-xl flex items-center justify-center text-white text-sm font-bold">S</div>
                <div class="flex-1 text-left">
                  <p class="text-sm font-medium text-neutral-900">UPS Southwest</p>
                  <p class="text-xs text-neutral-400">Workspace • 2 days ago</p>
                </div>
              </a>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Quick Actions Dialog -->
  <div id="quick-actions-dialog" class="fixed inset-0 z-[200] hidden">
    <!-- Backdrop -->
    <div class="absolute inset-0 bg-black/50 backdrop-blur-sm" onclick="closeQuickActionsDialog()"></div>
    
    <!-- Dialog Content -->
    <div class="absolute inset-0 flex items-start justify-center pt-24">
      <div class="bg-white rounded-2xl shadow-2xl w-full max-w-md overflow-hidden">
        <!-- Header -->
        <div class="flex items-center justify-between px-5 py-4 border-b border-neutral-100">
          <h2 class="text-base font-semibold text-neutral-900">Create new</h2>
          <button onclick="closeQuickActionsDialog()" class="p-1 text-neutral-400 hover:text-neutral-600">
            <i data-lucide="x" class="w-5 h-5"></i>
          </button>
        </div>
        
        <!-- Quick Action Options -->
        <div class="p-3">
          <div class="space-y-1">
            <!-- Campaign -->
            <button onclick="createAction('campaign')" class="w-full flex items-center gap-4 p-3 rounded-xl hover:bg-neutral-50 transition-colors group">
              <div class="w-10 h-10 bg-main-100 rounded-xl flex items-center justify-center text-main-600 group-hover:bg-main-200 transition-colors">
                <i data-lucide="send" class="w-5 h-5"></i>
              </div>
              <div class="flex-1 text-left">
                <p class="text-sm font-medium text-neutral-900">Campaign</p>
                <p class="text-xs text-neutral-500">Email, SMS, or social campaign</p>
              </div>
              <kbd class="px-2 py-0.5 text-xs font-medium text-neutral-400 bg-neutral-100 rounded border border-neutral-200">C</kbd>
            </button>
            
            <!-- Workspace -->
            <button onclick="createAction('workspace')" class="w-full flex items-center gap-4 p-3 rounded-xl hover:bg-neutral-50 transition-colors group">
              <div class="w-10 h-10 bg-accent-100 rounded-xl flex items-center justify-center text-accent-600 group-hover:bg-accent-200 transition-colors">
                <i data-lucide="layout-grid" class="w-5 h-5"></i>
              </div>
              <div class="flex-1 text-left">
                <p class="text-sm font-medium text-neutral-900">Workspace</p>
                <p class="text-xs text-neutral-500">New workspace for a team or project</p>
              </div>
              <kbd class="px-2 py-0.5 text-xs font-medium text-neutral-400 bg-neutral-100 rounded border border-neutral-200">W</kbd>
            </button>
            
            <!-- Team Member -->
            <button onclick="createAction('member')" class="w-full flex items-center gap-4 p-3 rounded-xl hover:bg-neutral-50 transition-colors group">
              <div class="w-10 h-10 bg-success-100 rounded-xl flex items-center justify-center text-success-600 group-hover:bg-success-200 transition-colors">
                <i data-lucide="user-plus" class="w-5 h-5"></i>
              </div>
              <div class="flex-1 text-left">
                <p class="text-sm font-medium text-neutral-900">Team member</p>
                <p class="text-xs text-neutral-500">Invite someone to your workspace</p>
              </div>
              <kbd class="px-2 py-0.5 text-xs font-medium text-neutral-400 bg-neutral-100 rounded border border-neutral-200">I</kbd>
            </button>
            
            <!-- Report -->
            <button onclick="createAction('report')" class="w-full flex items-center gap-4 p-3 rounded-xl hover:bg-neutral-50 transition-colors group">
              <div class="w-10 h-10 bg-warning-100 rounded-xl flex items-center justify-center text-warning-600 group-hover:bg-warning-200 transition-colors">
                <i data-lucide="bar-chart-2" class="w-5 h-5"></i>
              </div>
              <div class="flex-1 text-left">
                <p class="text-sm font-medium text-neutral-900">Report</p>
                <p class="text-xs text-neutral-500">Custom analytics report</p>
              </div>
              <kbd class="px-2 py-0.5 text-xs font-medium text-neutral-400 bg-neutral-100 rounded border border-neutral-200">R</kbd>
            </button>
            
            <!-- Contact List -->
            <button onclick="createAction('list')" class="w-full flex items-center gap-4 p-3 rounded-xl hover:bg-neutral-50 transition-colors group">
              <div class="w-10 h-10 bg-neutral-100 rounded-xl flex items-center justify-center text-neutral-600 group-hover:bg-neutral-200 transition-colors">
                <i data-lucide="users" class="w-5 h-5"></i>
              </div>
              <div class="flex-1 text-left">
                <p class="text-sm font-medium text-neutral-900">Contact list</p>
                <p class="text-xs text-neutral-500">New list or segment</p>
              </div>
              <kbd class="px-2 py-0.5 text-xs font-medium text-neutral-400 bg-neutral-100 rounded border border-neutral-200">L</kbd>
            </button>
            
            <!-- Folder -->
            <button onclick="createAction('folder')" class="w-full flex items-center gap-4 p-3 rounded-xl hover:bg-neutral-50 transition-colors group">
              <div class="w-10 h-10 bg-neutral-100 rounded-xl flex items-center justify-center text-neutral-600 group-hover:bg-neutral-200 transition-colors">
                <i data-lucide="folder-plus" class="w-5 h-5"></i>
              </div>
              <div class="flex-1 text-left">
                <p class="text-sm font-medium text-neutral-900">Folder</p>
                <p class="text-xs text-neutral-500">Organize workspaces together</p>
              </div>
              <kbd class="px-2 py-0.5 text-xs font-medium text-neutral-400 bg-neutral-100 rounded border border-neutral-200">F</kbd>
            </button>
          </div>
        </div>
        
        <!-- Recently Created -->
        <div class="px-5 py-3 border-t border-neutral-100 bg-neutral-50">
          <p class="text-xs font-semibold text-neutral-400 uppercase tracking-wide mb-2">Recently created</p>
          <div class="flex items-center gap-2">
            <a href="#" class="flex items-center gap-2 px-3 py-1.5 bg-white rounded-lg border border-neutral-200 hover:border-neutral-300 transition-colors">
              <i data-lucide="send" class="w-3.5 h-3.5 text-neutral-400"></i>
              <span class="text-xs text-neutral-600">Holiday Promo</span>
            </a>
            <a href="#" class="flex items-center gap-2 px-3 py-1.5 bg-white rounded-lg border border-neutral-200 hover:border-neutral-300 transition-colors">
              <i data-lucide="users" class="w-3.5 h-3.5 text-neutral-400"></i>
              <span class="text-xs text-neutral-600">VIP Customers</span>
            </a>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Create Workspace Modal -->
  <div id="create-workspace-modal" class="fixed inset-0 z-[100] hidden">
    <!-- Backdrop -->
    <div class="absolute inset-0 bg-gradient-to-br from-main-400/80 via-main-300/70 to-success-200/80 backdrop-blur-sm" onclick="closeCreateWorkspaceModal()"></div>
    
    <!-- Modal Content -->
    <div class="absolute inset-0 flex items-center justify-center p-8">
      <div class="bg-white rounded-3xl shadow-2xl p-8 max-w-lg w-full max-h-[90vh] overflow-y-auto">
        <!-- Header with back button -->
        <div class="flex items-center gap-3 mb-6">
          <button onclick="closeCreateWorkspaceModal()" class="text-neutral-400 hover:text-neutral-600">
            <i data-lucide="arrow-left" class="w-5 h-5"></i>
          </button>
          <h2 class="text-xl font-bold text-neutral-900">Set up your workspaces</h2>
        </div>

        <p class="text-neutral-600 mb-6">Add the workspaces you need to get started. You can always add more later.</p>

        <!-- Workspace inputs -->
        <div id="modal-workspace-list" class="space-y-3 mb-4">
          <div class="modal-workspace-item flex items-center gap-3">
            <div class="w-10 h-10 bg-main-50 rounded-xl flex items-center justify-center text-main-600 text-sm font-semibold">1</div>
            <input type="text" placeholder="e.g., New Jersey location" class="flex-1 px-4 py-3 border border-neutral-200 rounded-xl text-sm focus:outline-none focus:ring-2 focus:ring-blue-600 focus:border-transparent modal-workspace-input">
          </div>
        </div>

        <button onclick="addModalWorkspace()" class="flex items-center gap-2 text-main-600 hover:text-main-700 font-medium text-sm mb-6">
          <i data-lucide="plus" class="w-4 h-4"></i>
          Add another workspace
        </button>

        <!-- Folder grouping option -->
        <div class="bg-neutral-50 rounded-2xl p-5 mb-6">
          <label class="flex items-start gap-3 cursor-pointer">
            <input type="checkbox" id="modal-create-folder" class="w-5 h-5 mt-0.5 text-main-600 border-neutral-300 rounded focus:ring-main-500">
            <div>
              <span class="font-semibold text-neutral-900 block">Group these workspaces in a Folder</span>
              <span class="text-sm text-neutral-500">Folders let you see rolled-up reporting across workspaces and manage shared assets.</span>
            </div>
          </label>
          
          <!-- Folder Name Input (shown when checkbox is checked) -->
          <div id="modal-folder-name-container" class="mt-4 hidden">
            <label class="block text-sm font-medium text-neutral-700 mb-1.5">Folder name</label>
            <input type="text" id="modal-folder-name-input" placeholder="e.g., Northeast region" class="w-full px-4 py-3 border border-neutral-200 rounded-xl text-sm focus:outline-none focus:ring-2 focus:ring-blue-600 focus:border-transparent bg-white">
          </div>
        </div>

        <button onclick="createWorkspacesFromModal()" class="w-full py-4 bg-main-600 text-white rounded-2xl font-semibold text-sm hover:bg-main-700 transition-colors">
          Create workspaces
        </button>
      </div>
    </div>
  </div>

  <script>
    lucide.createIcons();

    // Get workspace name from URL parameter
    const urlParams = new URLSearchParams(window.location.search);
    const workspaceName = urlParams.get('workspace') || 'NE';
    
    // Dropdown toggle
    function toggleDropdown(dropdownId) {
      const dropdown = document.getElementById(dropdownId);
      const isHidden = dropdown.classList.contains('hidden');
      
      // Close all dropdowns first
      document.querySelectorAll('[id$="-metric-dropdown"]').forEach(d => d.classList.add('hidden'));
      
      if (isHidden) {
        dropdown.classList.remove('hidden');
      }
    }
    
    // Close dropdowns when clicking outside
    document.addEventListener('click', (e) => {
      if (!e.target.closest('[id$="-metric-dropdown"]') && !e.target.closest('button[onclick*="toggleDropdown"]')) {
        document.querySelectorAll('[id$="-metric-dropdown"]').forEach(d => d.classList.add('hidden'));
      }
    });
    
    // Select metric from dropdown
    function selectMetric(type, metric, label) {
      const labelEl = document.getElementById(type + '-metric-label');
      if (labelEl) {
        labelEl.textContent = label;
      }
      
      // Update checkmarks
      const checkClass = type === 'top' ? 'metric-check' : 'metric-check-low';
      document.querySelectorAll('.' + checkClass).forEach(check => {
        if (check.dataset.metric === metric) {
          check.classList.remove('hidden');
        } else {
          check.classList.add('hidden');
        }
      });
      
      // Close dropdown
      document.getElementById(type + '-metric-dropdown').classList.add('hidden');
      
      // Reinitialize icons for the checkmarks
      lucide.createIcons();
    }
    
    // Approval Modal Functions
    let emailNotificationEnabled = true;
    let currentApprovalId = null;
    
    function openApprovalModal(event, approvalId) {
      event.preventDefault();
      currentApprovalId = approvalId;
      
      const modal = document.getElementById('approval-modal');
      modal.classList.remove('hidden');
      document.body.style.overflow = 'hidden';
      
      // Reset form
      document.getElementById('approval-comment').value = '';
      updateCommentCount();
      
      // Reinitialize icons
      lucide.createIcons();
    }
    
    function closeApprovalModal() {
      const modal = document.getElementById('approval-modal');
      modal.classList.add('hidden');
      document.body.style.overflow = '';
      currentApprovalId = null;
    }
    
    function switchPreviewTab(tab) {
      const desktopTab = document.getElementById('preview-desktop-tab');
      const mobileTab = document.getElementById('preview-mobile-tab');
      const previewContainer = document.getElementById('email-preview-container');
      
      if (tab === 'desktop') {
        desktopTab.classList.add('text-main-600', 'border-main-600');
        desktopTab.classList.remove('text-neutral-400', 'border-transparent');
        mobileTab.classList.remove('text-main-600', 'border-main-600');
        mobileTab.classList.add('text-neutral-400', 'border-transparent');
        previewContainer.style.maxWidth = '600px';
      } else {
        mobileTab.classList.add('text-main-600', 'border-main-600');
        mobileTab.classList.remove('text-neutral-400', 'border-transparent');
        desktopTab.classList.remove('text-main-600', 'border-main-600');
        desktopTab.classList.add('text-neutral-400', 'border-transparent');
        previewContainer.style.maxWidth = '375px';
      }
    }
    
    function updateCommentCount() {
      const textarea = document.getElementById('approval-comment');
      const countEl = document.getElementById('comment-count');
      countEl.textContent = `${textarea.value.length}/400`;
    }
    
    function toggleEmailNotification() {
      emailNotificationEnabled = !emailNotificationEnabled;
      const toggle = document.getElementById('email-toggle');
      const dot = toggle.querySelector('span');
      
      if (emailNotificationEnabled) {
        toggle.classList.remove('bg-neutral-300');
        toggle.classList.add('bg-main-500');
        dot.classList.remove('left-1');
        dot.classList.add('right-1');
      } else {
        toggle.classList.remove('bg-main-500');
        toggle.classList.add('bg-neutral-300');
        dot.classList.remove('right-1');
        dot.classList.add('left-1');
      }
    }
    
    function approveApproval() {
      const comment = document.getElementById('approval-comment').value;
      console.log('Approved approval:', currentApprovalId, 'Comment:', comment, 'Send email:', emailNotificationEnabled);
      
      // Show success feedback
      alert('Campaign approved successfully!');
      closeApprovalModal();
      
      // Remove the approval item from the activity log (in a real app)
    }
    
    function rejectApproval() {
      const comment = document.getElementById('approval-comment').value;
      console.log('Rejected approval:', currentApprovalId, 'Comment:', comment, 'Send email:', emailNotificationEnabled);
      
      // Show feedback
      alert('Campaign rejected.');
      closeApprovalModal();
    }
    
    // Close modal on escape key
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape') {
        closeApprovalModal();
        closeCustomizeWidgetModal();
      }
    });
    
    // Activity Filter Functions
    function toggleActivityFilter(event) {
      event.stopPropagation();
      const menu = document.getElementById('activity-filter-menu');
      menu.classList.toggle('hidden');
    }
    
    function filterActivity(filterType) {
      // Close the filter menu
      const menu = document.getElementById('activity-filter-menu');
      if (menu) {
        menu.classList.add('hidden');
      }
      
      // Filter activity items
      const activityItems = document.querySelectorAll('#recent-activity > a, #recent-activity > div');
      activityItems.forEach(item => {
        const itemType = item.dataset.type;
        if (filterType === 'all' || itemType === filterType) {
          item.style.display = '';
        } else {
          item.style.display = 'none';
        }
      });
    }
    
    // Widget Menu Functions
    let currentWidgetId = null;
    
    function toggleWidgetMenu(event, widgetId) {
      event.stopPropagation();
      
      // Close all other widget menus
      document.querySelectorAll('[id^="widget-menu-"]').forEach(menu => {
        if (menu.id !== `widget-menu-${widgetId}`) {
          menu.classList.add('hidden');
        }
      });
      
      const menu = document.getElementById(`widget-menu-${widgetId}`);
      menu.classList.toggle('hidden');
      lucide.createIcons();
    }
    
    // Close widget menus when clicking outside
    document.addEventListener('click', (e) => {
      if (!e.target.closest('[id^="widget-menu-"]') && !e.target.closest('button[onclick*="toggleWidgetMenu"]')) {
        document.querySelectorAll('[id^="widget-menu-"]').forEach(menu => menu.classList.add('hidden'));
      }
      // Close activity filter menu
      if (!e.target.closest('#activity-filter-menu') && !e.target.closest('button[onclick*="toggleActivityFilter"]')) {
        const activityMenu = document.getElementById('activity-filter-menu');
        if (activityMenu) activityMenu.classList.add('hidden');
      }
    });
    
    function openCustomizeWidget(widgetId) {
      currentWidgetId = widgetId;
      
      // Close widget menu
      document.querySelectorAll('[id^="widget-menu-"]').forEach(menu => menu.classList.add('hidden'));
      
      // Open customize modal
      const modal = document.getElementById('customize-widget-modal');
      modal.classList.remove('hidden');
      document.body.style.overflow = 'hidden';
      
      // Set widget-specific defaults
      const widgetConfig = getWidgetConfig(widgetId);
      if (widgetConfig) {
        document.getElementById('widget-chart-type').value = widgetConfig.chartType || '1-stat';
        document.getElementById('widget-channel').value = widgetConfig.channel || 'email';
        
        // Set workspaces and date range if available
        if (widgetConfig.workspaces) {
          document.getElementById('widget-workspaces').value = widgetConfig.workspaces;
        }
        if (widgetConfig.dateRange) {
          document.getElementById('widget-date-range').value = widgetConfig.dateRange;
        }
        if (widgetConfig.showTrends !== undefined) {
          document.getElementById('widget-show-trends').checked = widgetConfig.showTrends;
        }
      }
      
      // Initialize dynamic stats UI
      updateStatsSelectionUI();
      
      // After UI is built, set the specific stat values from config
      if (widgetConfig && widgetConfig.stats) {
        setTimeout(() => {
          widgetConfig.stats.forEach((stat, index) => {
            const statEl = document.getElementById(`widget-stat-${index + 1}`);
            if (statEl) {
              statEl.value = stat;
            }
          });
          updateWidgetPreview();
        }, 10);
      }
      
      lucide.createIcons();
    }
    
    // All available metrics organized by category
    const allMetrics = {
      email: [
        { value: 'sends', label: 'Sends', format: 'number', sample: '1,247' },
        { value: 'opens', label: 'Opens', format: 'percent', sample: '24.5%' },
        { value: 'clicks', label: 'Clicks', format: 'percent', sample: '3.2%' },
        { value: 'bounces', label: 'Bounces', format: 'percent', sample: '1.8%' },
        { value: 'delivered', label: 'Delivered', format: 'percent', sample: '98.2%' },
        { value: 'unsubscribes', label: 'Unsubscribes', format: 'number', sample: '12' },
        { value: 'spam-reports', label: 'Spam reports', format: 'number', sample: '2' },
        { value: 'unique-opens', label: 'Unique opens', format: 'number', sample: '892' },
        { value: 'unique-clicks', label: 'Unique clicks', format: 'number', sample: '156' },
        { value: 'click-to-open', label: 'Click-to-open rate', format: 'percent', sample: '17.5%' },
        { value: 'revenue', label: 'Revenue', format: 'currency', sample: '$4,521' },
        { value: 'conversions', label: 'Conversions', format: 'number', sample: '34' }
      ],
      social: [
        { value: 'impressions', label: 'Impressions', format: 'number', sample: '12,450' },
        { value: 'reach', label: 'Reach', format: 'number', sample: '8,320' },
        { value: 'engagement', label: 'Engagement rate', format: 'percent', sample: '4.7%' },
        { value: 'likes', label: 'Likes', format: 'number', sample: '342' },
        { value: 'shares', label: 'Shares', format: 'number', sample: '58' },
        { value: 'comments', label: 'Comments', format: 'number', sample: '23' },
        { value: 'followers', label: 'New followers', format: 'number', sample: '+127' },
        { value: 'link-clicks', label: 'Link clicks', format: 'number', sample: '89' }
      ],
      sms: [
        { value: 'sent', label: 'Messages sent', format: 'number', sample: '2,456' },
        { value: 'delivered', label: 'Delivered', format: 'percent', sample: '97.8%' },
        { value: 'clicks', label: 'Link clicks', format: 'number', sample: '312' },
        { value: 'opt-outs', label: 'Opt-outs', format: 'number', sample: '8' },
        { value: 'replies', label: 'Replies', format: 'number', sample: '45' },
        { value: 'ctr', label: 'Click rate', format: 'percent', sample: '12.7%' }
      ],
      contacts: [
        { value: 'total-contacts', label: 'Total contacts', format: 'number', sample: '24,567' },
        { value: 'new-contacts', label: 'New contacts', format: 'number', sample: '+342' },
        { value: 'active-contacts', label: 'Active contacts', format: 'number', sample: '18,234' },
        { value: 'growth-rate', label: 'Growth rate', format: 'percent', sample: '+5.2%' },
        { value: 'unsubscribed', label: 'Unsubscribed', format: 'number', sample: '56' },
        { value: 'engagement-score', label: 'Avg engagement score', format: 'number', sample: '72' }
      ]
    };

    // Chart type configurations
    const chartTypeConfig = {
      '1-stat': { statCount: 1, label: 'Single Metric' },
      '2-stats': { statCount: 2, label: 'Two Metrics' },
      '4-stats': { statCount: 4, label: 'Four Metrics' },
      'bar': { statCount: 1, label: 'Bar Chart' },
      'donut': { statCount: 1, label: 'Donut Chart' },
      'line': { statCount: 1, label: 'Line Chart' },
      'leaderboard': { statCount: 1, label: 'Leaderboard' }
    };
    
    function closeCustomizeWidgetModal() {
      const modal = document.getElementById('customize-widget-modal');
      modal.classList.add('hidden');
      document.body.style.overflow = '';
      currentWidgetId = null;
    }
    
    function openAddWidgetModal() {
      currentWidgetId = 'new';
      const modal = document.getElementById('customize-widget-modal');
      modal.classList.remove('hidden');
      document.body.style.overflow = 'hidden';
      // Initialize with default chart type
      updateStatsSelectionUI();
      updateWidgetPreview();
      lucide.createIcons();
    }
    
    function getWidgetConfig(widgetId) {
      const configs = {
        'email-engagement': { chartType: '4-stats', channel: 'email', stats: ['sends', 'opens', 'clicks', 'bounces'] },
        'social-engagement': { chartType: '2-stats', channel: 'social', stats: ['impressions', 'engagement'] },
        'contact-growth': { chartType: '1-stat', channel: 'contacts', stats: ['total-contacts'], showTrends: true, workspaces: 'all', dateRange: '30-days' },
        'template-usage': { chartType: 'donut', channel: 'email', stats: ['sends'] },
        'recent-activity': { chartType: 'leaderboard', channel: 'email', stats: ['clicks'] }
      };
      return configs[widgetId] || null;
    }
    
    function getMetricsForChannel(channel) {
      return allMetrics[channel] || allMetrics.email;
    }

    function buildMetricDropdown(id, selectedValue, channel) {
      const metrics = getMetricsForChannel(channel);
      let options = metrics.map(m => 
        `<option value="${m.value}" ${m.value === selectedValue ? 'selected' : ''}>${m.label}</option>`
      ).join('');
      
      return `
        <div class="relative">
          <select id="${id}" onchange="updateWidgetPreview()" class="w-full px-3 py-2.5 border border-neutral-200 rounded-lg text-sm appearance-none bg-white focus:outline-none focus:ring-2 focus:ring-main-500 focus:border-transparent">
            ${options}
          </select>
          <i data-lucide="chevron-down" class="w-4 h-4 text-neutral-400 absolute right-3 top-1/2 -translate-y-1/2 pointer-events-none"></i>
        </div>
      `;
    }

    function updateStatsSelectionUI() {
      const chartType = document.getElementById('widget-chart-type').value;
      const channel = document.getElementById('widget-channel').value;
      const container = document.getElementById('stats-selection-container');
      const config = chartTypeConfig[chartType];
      const statCount = config.statCount;
      const metrics = getMetricsForChannel(channel);
      
      // Default selections for each stat position
      const defaults = ['sends', 'opens', 'clicks', 'bounces'];
      
      let html = '';
      
      if (statCount === 1) {
        html = `
          <div>
            <label class="block text-sm font-medium text-neutral-700 mb-2">Metric</label>
            ${buildMetricDropdown('widget-stat-1', metrics[0]?.value || defaults[0], channel)}
          </div>
        `;
      } else if (statCount === 2) {
        html = `
          <div class="grid grid-cols-2 gap-4">
            <div>
              <label class="block text-sm font-medium text-neutral-700 mb-2">Metric 1</label>
              ${buildMetricDropdown('widget-stat-1', metrics[0]?.value || defaults[0], channel)}
            </div>
            <div>
              <label class="block text-sm font-medium text-neutral-700 mb-2">Metric 2</label>
              ${buildMetricDropdown('widget-stat-2', metrics[1]?.value || defaults[1], channel)}
            </div>
          </div>
        `;
      } else if (statCount >= 4) {
        html = `
          <div class="grid grid-cols-2 gap-4">
            <div>
              <label class="block text-sm font-medium text-neutral-700 mb-2">Metric 1</label>
              ${buildMetricDropdown('widget-stat-1', metrics[0]?.value || defaults[0], channel)}
            </div>
            <div>
              <label class="block text-sm font-medium text-neutral-700 mb-2">Metric 2</label>
              ${buildMetricDropdown('widget-stat-2', metrics[1]?.value || defaults[1], channel)}
            </div>
          </div>
          <div class="grid grid-cols-2 gap-4 mt-4">
            <div>
              <label class="block text-sm font-medium text-neutral-700 mb-2">Metric 3</label>
              ${buildMetricDropdown('widget-stat-3', metrics[2]?.value || defaults[2], channel)}
            </div>
            <div>
              <label class="block text-sm font-medium text-neutral-700 mb-2">Metric 4</label>
              ${buildMetricDropdown('widget-stat-4', metrics[3]?.value || defaults[3], channel)}
            </div>
          </div>
        `;
      }
      
      container.innerHTML = html;
      lucide.createIcons();
      updateWidgetPreview();
    }

    function getMetricData(metricValue, channel) {
      const metrics = getMetricsForChannel(channel);
      return metrics.find(m => m.value === metricValue) || { label: metricValue, sample: '0' };
    }
    
    function updateWidgetPreview() {
      const chartType = document.getElementById('widget-chart-type').value;
      const channel = document.getElementById('widget-channel').value;
      const showTrends = document.getElementById('widget-show-trends')?.checked ?? true;
      const preview = document.getElementById('widget-preview');
      
      const channelLabel = channel === 'email' ? 'Email' : channel === 'social' ? 'Social' : channel === 'sms' ? 'SMS' : 'Contacts';
      const config = chartTypeConfig[chartType];
      
      // Get selected stats
      const stats = [];
      for (let i = 1; i <= config.statCount; i++) {
        const el = document.getElementById(`widget-stat-${i}`);
        if (el) stats.push(el.value);
      }
      
      let previewHTML = '';
      
      // Generate different previews based on chart type
      if (chartType === '1-stat') {
        const metric = getMetricData(stats[0], channel);
        previewHTML = `
          <div class="flex items-center justify-between mb-3">
            <h4 class="text-sm font-medium text-neutral-500">${metric.label}</h4>
            <i data-lucide="more-vertical" class="w-4 h-4 text-neutral-400"></i>
          </div>
          <div class="flex items-baseline gap-2">
            <span class="text-3xl font-semibold text-neutral-900">${metric.sample}</span>
            ${showTrends ? '<i data-lucide="arrow-up" class="w-4 h-4 text-success-600"></i>' : ''}
          </div>
        `;
      } else if (chartType === '2-stats') {
        const metric1 = getMetricData(stats[0], channel);
        const metric2 = getMetricData(stats[1], channel);
        previewHTML = `
          <div class="flex items-center justify-between mb-4">
            <h4 class="text-sm font-medium text-neutral-500">${channelLabel} performance</h4>
            <i data-lucide="more-vertical" class="w-4 h-4 text-neutral-400"></i>
          </div>
          <div class="grid grid-cols-2 gap-4">
            <div>
              <div class="flex items-baseline gap-1.5">
                <span class="text-xl font-semibold text-neutral-900">${metric1.sample}</span>
                ${showTrends ? '<i data-lucide="arrow-up" class="w-3 h-3 text-success-600"></i>' : ''}
              </div>
              <p class="text-xs text-neutral-500">${metric1.label}</p>
            </div>
            <div>
              <div class="flex items-baseline gap-1.5">
                <span class="text-xl font-semibold text-neutral-900">${metric2.sample}</span>
                ${showTrends ? '<i data-lucide="arrow-up" class="w-3 h-3 text-success-600"></i>' : ''}
              </div>
              <p class="text-xs text-neutral-500">${metric2.label}</p>
            </div>
          </div>
        `;
      } else if (chartType === '4-stats' || chartType === 'multi-stat') {
        const metric1 = getMetricData(stats[0], channel);
        const metric2 = getMetricData(stats[1], channel);
        const metric3 = getMetricData(stats[2], channel);
        const metric4 = getMetricData(stats[3], channel);
        previewHTML = `
          <div class="flex items-center justify-between mb-4">
            <h4 class="text-sm font-medium text-neutral-500">${channelLabel} engagement</h4>
            <i data-lucide="more-vertical" class="w-4 h-4 text-neutral-400"></i>
          </div>
          <div class="grid grid-cols-2 gap-x-6 gap-y-4">
            <div>
              <div class="flex items-baseline gap-1.5">
                <span class="text-lg font-normal text-neutral-900">${metric1.sample}</span>
                ${showTrends ? '<i data-lucide="arrow-up" class="w-3 h-3 text-success-600"></i>' : ''}
              </div>
              <p class="text-xs text-neutral-500">${metric1.label}</p>
            </div>
            <div>
              <div class="flex items-baseline gap-1.5">
                <span class="text-lg font-normal text-neutral-900">${metric2.sample}</span>
                ${showTrends ? '<i data-lucide="arrow-up" class="w-3 h-3 text-success-600"></i>' : ''}
              </div>
              <p class="text-xs text-neutral-500">${metric2.label}</p>
            </div>
            <div>
              <div class="flex items-baseline gap-1.5">
                <span class="text-lg font-normal text-neutral-900">${metric3.sample}</span>
                ${showTrends ? '<i data-lucide="arrow-up" class="w-3 h-3 text-success-600"></i>' : ''}
              </div>
              <p class="text-xs text-neutral-500">${metric3.label}</p>
            </div>
            <div>
              <div class="flex items-baseline gap-1.5">
                <span class="text-lg font-normal text-neutral-900">${metric4.sample}</span>
                ${showTrends ? '<i data-lucide="arrow-down" class="w-3 h-3 text-danger-400"></i>' : ''}
              </div>
              <p class="text-xs text-neutral-500">${metric4.label}</p>
            </div>
          </div>
        `;
      } else if (chartType === 'bar') {
        const metric = getMetricData(stats[0], channel);
        previewHTML = `
          <div class="flex items-center justify-between mb-3">
            <h4 class="text-sm font-medium text-neutral-500">${metric.label} by workspace</h4>
            <i data-lucide="more-vertical" class="w-4 h-4 text-neutral-400"></i>
          </div>
          <div class="flex gap-2">
            <!-- Y-axis labels -->
            <div class="flex flex-col justify-between text-[9px] text-neutral-400 h-20 py-1">
              <span>3k</span>
              <span>2k</span>
              <span>1k</span>
              <span>0</span>
            </div>
            <!-- Bars -->
            <div class="flex-1 flex items-end justify-around gap-2 h-20 border-l border-b border-neutral-200 pl-2 pb-1">
              <div class="flex flex-col items-center gap-1 flex-1">
                <div class="w-full bg-main-500 rounded-t" style="height: 85%"></div>
              </div>
              <div class="flex flex-col items-center gap-1 flex-1">
                <div class="w-full bg-main-500 rounded-t" style="height: 62%"></div>
              </div>
              <div class="flex flex-col items-center gap-1 flex-1">
                <div class="w-full bg-main-500 rounded-t" style="height: 45%"></div>
              </div>
              <div class="flex flex-col items-center gap-1 flex-1">
                <div class="w-full bg-main-500 rounded-t" style="height: 38%"></div>
              </div>
            </div>
          </div>
          <!-- X-axis labels -->
          <div class="flex justify-around text-[9px] text-neutral-400 mt-1 ml-6">
            <span>Greenwich</span>
            <span>NY</span>
            <span>NJ</span>
            <span>Boston</span>
          </div>
        `;
      } else if (chartType === 'donut') {
        const metric = getMetricData(stats[0], channel);
        previewHTML = `
          <div class="flex items-center justify-between mb-4">
            <h4 class="text-sm font-medium text-neutral-500">${metric.label} distribution</h4>
            <i data-lucide="more-vertical" class="w-4 h-4 text-neutral-400"></i>
          </div>
          <div class="flex items-center gap-4">
            <div class="relative w-20 h-20">
              <svg viewBox="0 0 36 36" class="w-full h-full -rotate-90">
                <circle cx="18" cy="18" r="15.9" fill="none" stroke="#e5e7eb" stroke-width="3.5"></circle>
                <circle cx="18" cy="18" r="15.9" fill="none" stroke="#6366f1" stroke-width="3.5" stroke-dasharray="36 64" stroke-linecap="round"></circle>
                <circle cx="18" cy="18" r="15.9" fill="none" stroke="#818cf8" stroke-width="3.5" stroke-dasharray="22 78" stroke-dashoffset="-42" stroke-linecap="round"></circle>
                <circle cx="18" cy="18" r="15.9" fill="none" stroke="#a5b4fc" stroke-width="3.5" stroke-dasharray="18 82" stroke-dashoffset="-70" stroke-linecap="round"></circle>
              </svg>
            </div>
            <div class="space-y-1.5 text-xs">
              <div class="flex items-center gap-2">
                <span class="w-2 h-2 rounded-full bg-main-500"></span>
                <span class="text-neutral-600">Greenwich (45%)</span>
              </div>
              <div class="flex items-center gap-2">
                <span class="w-2 h-2 rounded-full bg-main-400"></span>
                <span class="text-neutral-600">New York (30%)</span>
              </div>
              <div class="flex items-center gap-2">
                <span class="w-2 h-2 rounded-full bg-main-300"></span>
                <span class="text-neutral-600">New Jersey (25%)</span>
              </div>
            </div>
          </div>
        `;
      } else if (chartType === 'line') {
        const metric = getMetricData(stats[0], channel);
        previewHTML = `
          <div class="flex items-center justify-between mb-3">
            <h4 class="text-sm font-medium text-neutral-500">${metric.label} over time</h4>
            <i data-lucide="more-vertical" class="w-4 h-4 text-neutral-400"></i>
          </div>
          <div class="flex gap-2">
            <!-- Y-axis labels -->
            <div class="flex flex-col justify-between text-[9px] text-neutral-400 h-20 py-1">
              <span>100%</span>
              <span>50%</span>
              <span>0%</span>
            </div>
            <!-- Chart area -->
            <div class="flex-1 h-20 border-l border-b border-neutral-200 relative">
              <svg viewBox="0 0 200 80" class="w-full h-full" preserveAspectRatio="none">
                <defs>
                  <linearGradient id="lineGradient" x1="0%" y1="0%" x2="0%" y2="100%">
                    <stop offset="0%" style="stop-color:#6366f1;stop-opacity:0.3" />
                    <stop offset="100%" style="stop-color:#6366f1;stop-opacity:0.02" />
                  </linearGradient>
                </defs>
                <!-- Gradient fill area -->
                <path d="M0,65 C20,60 40,50 60,45 C80,40 100,35 120,30 C140,25 160,20 180,15 C190,12 200,10 200,10 L200,80 L0,80 Z" fill="url(#lineGradient)"></path>
                <!-- Smooth curve line -->
                <path d="M0,65 C20,60 40,50 60,45 C80,40 100,35 120,30 C140,25 160,20 180,15 C190,12 200,10 200,10" fill="none" stroke="#6366f1" stroke-width="2" stroke-linecap="round"></path>
                <!-- End dot -->
                <circle cx="200" cy="10" r="3" fill="#6366f1"></circle>
              </svg>
            </div>
          </div>
          <!-- X-axis labels -->
          <div class="flex justify-between text-[9px] text-neutral-400 mt-1 ml-8">
            <span>Jan</span>
            <span>Feb</span>
            <span>Mar</span>
            <span>Apr</span>
          </div>
        `;
      } else if (chartType === 'leaderboard') {
        previewHTML = `
          <div class="flex items-center justify-between mb-3">
            <h4 class="text-sm font-medium text-neutral-500">Top performing campaigns</h4>
            <i data-lucide="more-vertical" class="w-4 h-4 text-neutral-400"></i>
          </div>
          <div class="space-y-2.5">
            <div>
              <div class="flex items-center justify-between mb-1">
                <span class="text-[10px] text-neutral-700 truncate flex-1">Summer Sale Newsletter</span>
                <span class="text-[10px] font-medium text-neutral-900 ml-2">32.4%</span>
              </div>
              <div class="h-1.5 bg-neutral-100 rounded-full overflow-hidden">
                <div class="h-full bg-main-500 rounded-full" style="width: 100%"></div>
              </div>
            </div>
            <div>
              <div class="flex items-center justify-between mb-1">
                <span class="text-[10px] text-neutral-700 truncate flex-1">Product Launch</span>
                <span class="text-[10px] font-medium text-neutral-900 ml-2">28.1%</span>
              </div>
              <div class="h-1.5 bg-neutral-100 rounded-full overflow-hidden">
                <div class="h-full bg-main-400 rounded-full" style="width: 87%"></div>
              </div>
            </div>
            <div>
              <div class="flex items-center justify-between mb-1">
                <span class="text-[10px] text-neutral-700 truncate flex-1">Weekly Update</span>
                <span class="text-[10px] font-medium text-neutral-900 ml-2">24.7%</span>
              </div>
              <div class="h-1.5 bg-neutral-100 rounded-full overflow-hidden">
                <div class="h-full bg-main-300 rounded-full" style="width: 76%"></div>
              </div>
            </div>
            <div>
              <div class="flex items-center justify-between mb-1">
                <span class="text-[10px] text-neutral-700 truncate flex-1">Holiday Promo</span>
                <span class="text-[10px] font-medium text-neutral-900 ml-2">19.2%</span>
              </div>
              <div class="h-1.5 bg-neutral-100 rounded-full overflow-hidden">
                <div class="h-full bg-main-200 rounded-full" style="width: 59%"></div>
              </div>
            </div>
          </div>
        `;
      }
      
      preview.innerHTML = previewHTML;
      lucide.createIcons();
    }
    
    function saveWidgetSettings() {
      const settings = {
        chartType: document.getElementById('widget-chart-type').value,
        channel: document.getElementById('widget-channel').value,
        stat1: document.getElementById('widget-stat-1').value,
        stat2: document.getElementById('widget-stat-2').value,
        stat3: document.getElementById('widget-stat-3').value,
        stat4: document.getElementById('widget-stat-4').value,
        showTrends: document.getElementById('widget-show-trends').checked,
        workspaces: document.getElementById('widget-workspaces').value,
        dateRange: document.getElementById('widget-date-range').value
      };
      
      console.log('Saving widget settings:', currentWidgetId, settings);
      
      // In a real app, this would update the widget
      if (currentWidgetId === 'new') {
        alert('Widget added successfully!');
      } else {
        alert('Widget settings saved!');
      }
      
      closeCustomizeWidgetModal();
    }
    
    // Custom Widget Saving
    let savedCustomWidgets = JSON.parse(localStorage.getItem('customWidgets') || '[]');
    
    function openSaveCustomWidgetDialog() {
      const modal = document.getElementById('save-custom-widget-modal');
      modal.classList.remove('hidden');
      document.getElementById('custom-widget-name').value = '';
      document.getElementById('custom-widget-description').value = '';
      lucide.createIcons();
    }
    
    function closeSaveCustomWidgetDialog() {
      const modal = document.getElementById('save-custom-widget-modal');
      modal.classList.add('hidden');
    }
    
    function saveCustomWidget() {
      const name = document.getElementById('custom-widget-name').value.trim();
      const description = document.getElementById('custom-widget-description').value.trim();
      
      if (!name) {
        alert('Please enter a widget name');
        return;
      }
      
      const widgetConfig = {
        id: 'custom-' + Date.now(),
        name: name,
        description: description,
        chartType: document.getElementById('widget-chart-type').value,
        channel: document.getElementById('widget-channel').value,
        stat1: document.getElementById('widget-stat-1').value,
        stat2: document.getElementById('widget-stat-2').value,
        stat3: document.getElementById('widget-stat-3').value,
        stat4: document.getElementById('widget-stat-4').value,
        showTrends: document.getElementById('widget-show-trends').checked,
        workspaces: document.getElementById('widget-workspaces').value,
        dateRange: document.getElementById('widget-date-range').value,
        createdAt: new Date().toISOString()
      };
      
      savedCustomWidgets.push(widgetConfig);
      localStorage.setItem('customWidgets', JSON.stringify(savedCustomWidgets));
      
      closeSaveCustomWidgetDialog();
      alert(`Widget "${name}" saved successfully! You can find it in your custom widgets when adding a new widget.`);
    }
    
    function removeWidget(widgetId) {
      if (confirm('Are you sure you want to remove this widget?')) {
        const widget = document.querySelector(`[data-widget-id="${widgetId}"]`);
        if (widget) {
          widget.remove();
        }
        document.querySelectorAll('[id^="widget-menu-"]').forEach(menu => menu.classList.add('hidden'));
      }
    }
    

    // Toggle expandable sections
    function toggleSection(section) {
      const items = document.getElementById(section + '-items');
      const chevron = document.getElementById(section + '-chevron');
      
      if (items.classList.contains('hidden')) {
        items.classList.remove('hidden');
        chevron.style.transform = 'rotate(0deg)';
      } else {
        items.classList.add('hidden');
        chevron.style.transform = 'rotate(180deg)';
      }
    }

    // Modal functions
    let modalWorkspaceCount = 1;

    // Global Search Dialog Functions
    function openGlobalSearchDialog(query = '') {
      const dialog = document.getElementById('global-search-dialog');
      dialog.classList.remove('hidden');
      document.body.style.overflow = 'hidden';
      
      // Set initial query if provided
      const searchInput = document.getElementById('global-search-input');
      if (query) {
        searchInput.value = query;
        handleGlobalSearch(query);
      }
      
      // Focus the search input
      setTimeout(() => {
        searchInput.focus();
        if (query) {
          searchInput.select();
        }
      }, 100);
      lucide.createIcons();
    }
    
    function closeGlobalSearchDialog() {
      const dialog = document.getElementById('global-search-dialog');
      dialog.classList.add('hidden');
      document.body.style.overflow = '';
      document.getElementById('global-search-input').value = '';
      document.getElementById('topbar-search-input').value = '';
      // Reset to default view
      document.getElementById('search-results-section').classList.add('hidden');
      document.getElementById('search-results-section').innerHTML = '';
      document.getElementById('recent-activity-section').classList.remove('hidden');
    }
    
    function handleTopbarSearchKeydown(event) {
      if (event.key === 'Enter') {
        const query = event.target.value.trim();
        openGlobalSearchDialog(query);
      }
    }
    
    function handleSearchDialogKeydown(event) {
      if (event.key === 'Enter') {
        // Could navigate to first result here
      }
    }
    
    // Search data
    const searchData = {
      workspaces: [
        { name: 'UPS Global', type: 'workspace', icon: 'G', color: 'bg-warning-800 text-warning-300' },
        { name: 'UPS Northeast', type: 'workspace', icon: 'N', color: 'bg-success-500 text-white' },
        { name: 'UPS Southwest', type: 'workspace', icon: 'S', color: 'bg-warning-500 text-white' },
        { name: 'UPS Midwest', type: 'workspace', icon: 'M', color: 'bg-success-500 text-white' },
        { name: 'UPS Foundation', type: 'workspace', icon: 'F', color: 'bg-accent-500 text-white' }
      ],
      campaigns: [
        { name: 'Holiday Shipping Promo', type: 'campaign', workspace: 'UPS Northeast' },
        { name: 'Express Delivery Update', type: 'campaign', workspace: 'UPS Southwest' },
        { name: 'New Location Announcement', type: 'campaign', workspace: 'UPS Midwest' },
        { name: 'Summer Sale Blast', type: 'campaign', workspace: 'UPS Global' }
      ],
      lists: [
        { name: 'VIP Customers', type: 'list', count: '2.4k contacts' },
        { name: 'Newsletter Subscribers', type: 'list', count: '15.2k contacts' },
        { name: 'Enterprise Clients', type: 'list', count: '892 contacts' }
      ],
      reports: [
        { name: 'Q4 Performance Report', type: 'report', workspace: 'UPS Global' },
        { name: 'Email Campaign Analysis', type: 'report', workspace: 'UPS Northeast' }
      ]
    };
    
    function handleGlobalSearch(query) {
      const searchResultsSection = document.getElementById('search-results-section');
      const recentActivitySection = document.getElementById('recent-activity-section');
      
      if (!query.trim()) {
        searchResultsSection.classList.add('hidden');
        searchResultsSection.innerHTML = '';
        recentActivitySection.classList.remove('hidden');
        return;
      }
      
      const lowerQuery = query.toLowerCase();
      
      // Filter results
      const matchedWorkspaces = searchData.workspaces.filter(w => w.name.toLowerCase().includes(lowerQuery));
      const matchedCampaigns = searchData.campaigns.filter(c => c.name.toLowerCase().includes(lowerQuery));
      const matchedLists = searchData.lists.filter(l => l.name.toLowerCase().includes(lowerQuery));
      const matchedReports = searchData.reports.filter(r => r.name.toLowerCase().includes(lowerQuery));
      
      const totalResults = matchedWorkspaces.length + matchedCampaigns.length + matchedLists.length + matchedReports.length;
      
      let html = '';
      
      // Results header
      html += `<div class="px-5 py-3 border-b border-neutral-100 bg-neutral-50">
        <p class="text-xs font-semibold text-neutral-500">${totalResults} result${totalResults !== 1 ? 's' : ''} for "${query}"</p>
      </div>`;
      
      if (totalResults === 0) {
        html += `<div class="px-5 py-8 text-center">
          <div class="w-12 h-12 bg-neutral-100 rounded-full flex items-center justify-center mx-auto mb-3">
            <i data-lucide="search-x" class="w-6 h-6 text-neutral-400"></i>
          </div>
          <p class="text-sm text-neutral-600 font-medium">No results found</p>
          <p class="text-xs text-neutral-400 mt-1">Try a different search term</p>
        </div>`;
      } else {
        html += '<div class="px-2 py-2">';
        
        if (matchedWorkspaces.length > 0) {
          html += `<p class="px-3 pt-2 text-xs font-semibold text-neutral-400 uppercase tracking-wide mb-2">Workspaces</p>
            <div class="space-y-0.5 mb-3">`;
          matchedWorkspaces.forEach(w => {
            html += `<a href="workspace-detail.html?workspace=${encodeURIComponent(w.name)}" class="w-full flex items-center gap-3 px-3 py-2.5 rounded-xl hover:bg-neutral-50 transition-colors block">
              <div class="w-10 h-10 ${w.color} rounded-xl flex items-center justify-center text-sm font-bold">${w.icon}</div>
              <div class="text-left">
                <p class="text-sm font-medium text-neutral-900">${w.name}</p>
                <p class="text-xs text-neutral-400">Workspace</p>
              </div>
            </a>`;
          });
          html += `</div>`;
        }
        
        if (matchedCampaigns.length > 0) {
          html += `<p class="px-3 pt-2 text-xs font-semibold text-neutral-400 uppercase tracking-wide mb-2">Campaigns</p>
            <div class="space-y-0.5 mb-3">`;
          matchedCampaigns.forEach(c => {
            html += `<a href="#" class="w-full flex items-center gap-3 px-3 py-2.5 rounded-xl hover:bg-neutral-50 transition-colors block">
              <div class="w-10 h-10 bg-main-100 rounded-xl flex items-center justify-center">
                <i data-lucide="send" class="w-5 h-5 text-main-600"></i>
              </div>
              <div class="text-left">
                <p class="text-sm font-medium text-neutral-900">${c.name}</p>
                <p class="text-xs text-neutral-400">Campaign • ${c.workspace}</p>
              </div>
            </a>`;
          });
          html += `</div>`;
        }
        
        if (matchedLists.length > 0) {
          html += `<p class="px-3 pt-2 text-xs font-semibold text-neutral-400 uppercase tracking-wide mb-2">Contact lists</p>
            <div class="space-y-0.5 mb-3">`;
          matchedLists.forEach(l => {
            html += `<a href="contacts-list.html" class="w-full flex items-center gap-3 px-3 py-2.5 rounded-xl hover:bg-neutral-50 transition-colors block">
              <div class="w-10 h-10 bg-neutral-100 rounded-xl flex items-center justify-center">
                <i data-lucide="users" class="w-5 h-5 text-neutral-600"></i>
              </div>
              <div class="text-left">
                <p class="text-sm font-medium text-neutral-900">${l.name}</p>
                <p class="text-xs text-neutral-400">${l.count}</p>
              </div>
            </a>`;
          });
          html += `</div>`;
        }
        
        if (matchedReports.length > 0) {
          html += `<p class="px-3 pt-2 text-xs font-semibold text-neutral-400 uppercase tracking-wide mb-2">Reports</p>
            <div class="space-y-0.5 mb-3">`;
          matchedReports.forEach(r => {
            html += `<a href="folder-reporting.html" class="w-full flex items-center gap-3 px-3 py-2.5 rounded-xl hover:bg-neutral-50 transition-colors block">
              <div class="w-10 h-10 bg-warning-100 rounded-xl flex items-center justify-center">
                <i data-lucide="bar-chart-2" class="w-5 h-5 text-warning-600"></i>
              </div>
              <div class="text-left">
                <p class="text-sm font-medium text-neutral-900">${r.name}</p>
                <p class="text-xs text-neutral-400">Report • ${r.workspace}</p>
              </div>
            </a>`;
          });
          html += `</div>`;
        }
        
        html += '</div>';
      }
      
      // Show search results, keep recent activity below
      searchResultsSection.innerHTML = html;
      searchResultsSection.classList.remove('hidden');
      lucide.createIcons();
    }
    
    function switchWorkspace(name) {
      closeGlobalSearchDialog();
      window.location.href = `workspace-detail.html?workspace=${encodeURIComponent(name)}`;
    }
    
    // Quick Actions Dialog Functions
    function openQuickActionsDialog() {
      const dialog = document.getElementById('quick-actions-dialog');
      dialog.classList.remove('hidden');
      document.body.style.overflow = 'hidden';
      lucide.createIcons();
    }
    
    function closeQuickActionsDialog() {
      const dialog = document.getElementById('quick-actions-dialog');
      dialog.classList.add('hidden');
      document.body.style.overflow = '';
    }
    
    function createAction(type) {
      closeQuickActionsDialog();
      switch(type) {
        case 'campaign':
          window.location.href = 'campaigns-list.html';
          break;
        case 'workspace':
          openCreateWorkspaceModal();
          break;
        case 'member':
          alert('Opening invite member dialog...');
          break;
        case 'report':
          window.location.href = 'folder-reporting.html';
          break;
        case 'list':
          window.location.href = 'contacts-list.html';
          break;
        case 'folder':
          openCreateFolderModal();
          break;
      }
    }
    
    // Keyboard shortcuts for dialogs
    document.addEventListener('keydown', (e) => {
      // Close dialogs on Escape
      if (e.key === 'Escape') {
        closeGlobalSearchDialog();
        closeQuickActionsDialog();
      }
      
      // Open search with Cmd/Ctrl + K
      if ((e.metaKey || e.ctrlKey) && e.key === 'k') {
        e.preventDefault();
        openGlobalSearchDialog();
      }
    });

    function openCreateWorkspaceModal() {
      document.getElementById('create-workspace-modal').classList.remove('hidden');
      document.getElementById('modal-create-folder').checked = false;
      document.getElementById('modal-folder-name-container').classList.add('hidden');
      document.body.style.overflow = 'hidden';
      lucide.createIcons();
    }

    function openCreateFolderModal() {
      document.getElementById('create-workspace-modal').classList.remove('hidden');
      document.getElementById('modal-create-folder').checked = true;
      document.getElementById('modal-folder-name-container').classList.remove('hidden');
      document.body.style.overflow = 'hidden';
      lucide.createIcons();
    }

    function closeCreateWorkspaceModal() {
      document.getElementById('create-workspace-modal').classList.add('hidden');
      document.body.style.overflow = '';
    }

    function addModalWorkspace() {
      modalWorkspaceCount++;
      const workspaceList = document.getElementById('modal-workspace-list');
      const newItem = document.createElement('div');
      newItem.className = 'modal-workspace-item flex items-center gap-3';
      newItem.innerHTML = `
        <div class="w-10 h-10 bg-main-50 rounded-xl flex items-center justify-center text-main-600 text-sm font-semibold">${modalWorkspaceCount}</div>
        <input type="text" placeholder="e.g., Connecticut location" class="flex-1 px-4 py-3 border border-neutral-200 rounded-xl text-sm focus:outline-none focus:ring-2 focus:ring-blue-600 focus:border-transparent modal-workspace-input">
        <button onclick="removeModalWorkspace(this)" class="text-neutral-400 hover:text-danger-500 p-1">
          <i data-lucide="x" class="w-4 h-4"></i>
        </button>
      `;
      workspaceList.appendChild(newItem);
      lucide.createIcons();
      updateModalWorkspaceNumbers();
    }

    function removeModalWorkspace(btn) {
      if (document.querySelectorAll('.modal-workspace-item').length > 1) {
        btn.closest('.modal-workspace-item').remove();
        modalWorkspaceCount--;
        updateModalWorkspaceNumbers();
      }
    }

    function updateModalWorkspaceNumbers() {
      const items = document.querySelectorAll('.modal-workspace-item');
      items.forEach((item, index) => {
        const numberDiv = item.querySelector('.w-10');
        numberDiv.textContent = index + 1;
      });
    }

    // Folder checkbox toggle - wait for DOM to be ready
    document.addEventListener('DOMContentLoaded', function() {
      document.getElementById('modal-create-folder').addEventListener('change', function() {
        const folderContainer = document.getElementById('modal-folder-name-container');
        if (this.checked) {
          folderContainer.classList.remove('hidden');
        } else {
          folderContainer.classList.add('hidden');
        }
      });
      
      // Check for URL parameter to open modals
      const urlParams = new URLSearchParams(window.location.search);
      const modalParam = urlParams.get('modal');
      
      if (modalParam === 'customize') {
        // Open the customize widget modal
        setTimeout(() => {
          openAddWidgetModal();
        }, 500);
      }
    });

    function createWorkspacesFromModal() {
      // Get all workspace names
      const inputs = document.querySelectorAll('#modal-workspace-list input');
      const newWorkspaces = [];
      inputs.forEach(input => {
        if (input.value.trim()) {
          newWorkspaces.push(input.value.trim());
        }
      });

      const folderName = document.getElementById('modal-folder-name-input').value.trim();
      const createFolder = document.getElementById('modal-create-folder').checked && folderName;

      // Save to sessionStorage
      if (createFolder) {
        const existingFolders = JSON.parse(sessionStorage.getItem('folders') || '[]');
        existingFolders.push({ name: folderName, workspaces: newWorkspaces });
        sessionStorage.setItem('folders', JSON.stringify(existingFolders));
      } else {
        const existingWorkspaces = JSON.parse(sessionStorage.getItem('workspaces') || '[]');
        sessionStorage.setItem('workspaces', JSON.stringify([...existingWorkspaces, ...newWorkspaces]));
      }
      
      // Go to workspaces list
      window.location.href = 'workspaces-list.html';
    }

    // Data mode toggle
    let currentDataMode = sessionStorage.getItem('dataMode') || 'filled';
    
    function setDataMode(mode) {
      currentDataMode = mode;
      sessionStorage.setItem('dataMode', mode);
      
      const emptyBtn = document.getElementById('toggle-empty');
      const filledBtn = document.getElementById('toggle-filled');
      
      if (mode === 'empty') {
        emptyBtn.className = 'px-2.5 py-1 text-xs rounded bg-neutral-600 text-white';
        filledBtn.className = 'px-2.5 py-1 text-xs rounded text-neutral-400 hover:text-white';
        renderEmptyDashboard();
      } else {
        filledBtn.className = 'px-2.5 py-1 text-xs rounded bg-neutral-600 text-white';
        emptyBtn.className = 'px-2.5 py-1 text-xs rounded text-neutral-400 hover:text-white';
        renderFilledDashboard();
      }
      lucide.createIcons();
    }
    
    function renderEmptyDashboard() {
      // Email metrics
      updateMetric('metric-sends', '—', true);
      updateMetric('metric-opens', '—', true);
      updateMetric('metric-clicks', '—', true);
      updateMetric('metric-bounces', '—', true);
      
      // Social metrics
      updateMetric('metric-views', '—', true);
      updateMetric('metric-likes', '—', true);
      
      // Contact & Templates
      updateMetric('metric-contacts', '—', true);
      updateMetric('metric-templates', '—', true);
      
      // Template donut - hide colored segments
      const donutSvg = document.getElementById('template-donut-svg');
      if (donutSvg) {
        const circles = donutSvg.querySelectorAll('circle:not(:first-child)');
        circles.forEach(c => c.setAttribute('stroke', '#F3F4F6'));
      }
      
      // Top workspaces - reset progress bars
      const topWs = document.getElementById('top-workspaces');
      if (topWs) {
        topWs.innerHTML = `
          <div class="flex items-center gap-3">
            <div class="flex items-center gap-2 w-28 flex-shrink-0">
              <div class="w-2 h-2 rounded-full flex-shrink-0 bg-neutral-200"></div>
              <span class="text-sm text-neutral-400">—</span>
            </div>
            <div class="flex-1 h-1.5 bg-neutral-100 rounded-full"></div>
          </div>
          <div class="flex items-center gap-3">
            <div class="flex items-center gap-2 w-28 flex-shrink-0">
              <div class="w-2 h-2 rounded-full flex-shrink-0 bg-neutral-200"></div>
              <span class="text-sm text-neutral-400">—</span>
            </div>
            <div class="flex-1 h-1.5 bg-neutral-100 rounded-full"></div>
          </div>
          <div class="flex items-center gap-3">
            <div class="flex items-center gap-2 w-28 flex-shrink-0">
              <div class="w-2 h-2 rounded-full flex-shrink-0 bg-neutral-200"></div>
              <span class="text-sm text-neutral-400">—</span>
            </div>
            <div class="flex-1 h-1.5 bg-neutral-100 rounded-full"></div>
          </div>
        `;
      }
      
      // Recent activity
      const activity = document.getElementById('recent-activity');
      if (activity) {
        activity.innerHTML = `
          <p class="text-sm text-neutral-400">No recent activity</p>
          <p class="text-xs text-neutral-300 mt-1">Activity will appear here</p>
        `;
        activity.className = 'text-center py-20';
      }
    }
    
    function renderFilledDashboard() {
      // Email metrics
      updateMetric('metric-sends', '1260', false);
      updateMetric('metric-opens', '460', false);
      updateMetric('metric-clicks', '432', false);
      updateMetric('metric-bounces', '32', false);
      
      // Social metrics
      updateMetric('metric-views', '1260', false);
      updateMetric('metric-likes', '460', false);
      
      // Contact & Templates
      updateMetric('metric-contacts', '1,321', false);
      updateMetric('metric-templates', '34', false);
      
      // Template donut - restore colored segments (blues)
      const donutSvg = document.getElementById('template-donut-svg');
      if (donutSvg) {
        const circles = donutSvg.querySelectorAll('circle:not(:first-child)');
        const cssVars = ['var(--donut-1)', 'var(--donut-2)', 'var(--donut-3)', 'var(--donut-4)'];
        circles.forEach((c, i) => c.setAttribute('stroke', cssVars[i] || '#F3F4F6'));
      }
      
      // Top workspaces - horizontal layout: label | rounded bar with hover %
      const topWs = document.getElementById('top-workspaces');
      if (topWs) {
        topWs.innerHTML = `
          <!-- Workspace 1 -->
          <a href="workspace-detail.html?id=nj" class="flex items-center gap-3 group hover:bg-neutral-50 -mx-2 px-2 py-1 rounded-lg transition-colors cursor-pointer">
            <div class="flex items-center gap-2 w-28 flex-shrink-0">
              <div class="w-2 h-2 rounded-full flex-shrink-0" style="background: var(--workspace-1)"></div>
              <span class="text-sm text-neutral-700 truncate group-hover:text-neutral-900">NJ Location</span>
            </div>
            <div class="flex-1 h-1.5 bg-neutral-100 rounded-full relative">
              <div class="absolute left-0 top-0 h-full rounded-full transition-all" style="width: 80%; background: var(--workspace-1)"></div>
              <span class="absolute right-0 top-1/2 -translate-y-1/2 px-2 py-0.5 bg-neutral-800 text-white text-xs rounded opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none">80%</span>
            </div>
          </a>
          <!-- Workspace 2 -->
          <a href="workspace-detail.html?id=ny" class="flex items-center gap-3 group hover:bg-neutral-50 -mx-2 px-2 py-1 rounded-lg transition-colors cursor-pointer">
            <div class="flex items-center gap-2 w-28 flex-shrink-0">
              <div class="w-2 h-2 rounded-full flex-shrink-0" style="background: var(--workspace-2)"></div>
              <span class="text-sm text-neutral-700 truncate group-hover:text-neutral-900">NY Location</span>
            </div>
            <div class="flex-1 h-1.5 bg-neutral-100 rounded-full relative">
              <div class="absolute left-0 top-0 h-full rounded-full transition-all" style="width: 60%; background: var(--workspace-2)"></div>
              <span class="absolute right-0 top-1/2 -translate-y-1/2 px-2 py-0.5 bg-neutral-800 text-white text-xs rounded opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none">60%</span>
            </div>
          </a>
          <!-- Workspace 3 -->
          <a href="workspace-detail.html?id=ct" class="flex items-center gap-3 group hover:bg-neutral-50 -mx-2 px-2 py-1 rounded-lg transition-colors cursor-pointer">
            <div class="flex items-center gap-2 w-28 flex-shrink-0">
              <div class="w-2 h-2 rounded-full flex-shrink-0" style="background: var(--workspace-3)"></div>
              <span class="text-sm text-neutral-700 truncate group-hover:text-neutral-900">CT Location</span>
            </div>
            <div class="flex-1 h-1.5 bg-neutral-100 rounded-full relative">
              <div class="absolute left-0 top-0 h-full rounded-full transition-all" style="width: 40%; background: var(--workspace-3)"></div>
              <span class="absolute right-0 top-1/2 -translate-y-1/2 px-2 py-0.5 bg-neutral-800 text-white text-xs rounded opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none">40%</span>
            </div>
          </a>
        `;
      }
      
      // Low performing workspaces - same horizontal layout with hover %
      const lowWs = document.getElementById('low-workspaces');
      if (lowWs) {
        lowWs.innerHTML = `
          <!-- Workspace 1 -->
          <a href="workspace-detail.html?id=ma" class="flex items-center gap-3 group hover:bg-neutral-50 -mx-2 px-2 py-1 rounded-lg transition-colors cursor-pointer">
            <div class="flex items-center gap-2 w-28 flex-shrink-0">
              <div class="w-2 h-2 rounded-full flex-shrink-0" style="background: var(--workspace-low-1)"></div>
              <span class="text-sm text-neutral-700 truncate group-hover:text-neutral-900">MA Location</span>
            </div>
            <div class="flex-1 h-1.5 bg-neutral-100 rounded-full relative">
              <div class="absolute left-0 top-0 h-full rounded-full transition-all" style="width: 8%; min-width: 6px; background: var(--workspace-low-1)"></div>
              <span class="absolute right-0 top-1/2 -translate-y-1/2 px-2 py-0.5 bg-neutral-800 text-white text-xs rounded opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none">8%</span>
            </div>
          </a>
          <!-- Workspace 2 -->
          <a href="workspace-detail.html?id=ri" class="flex items-center gap-3 group hover:bg-neutral-50 -mx-2 px-2 py-1 rounded-lg transition-colors cursor-pointer">
            <div class="flex items-center gap-2 w-28 flex-shrink-0">
              <div class="w-2 h-2 rounded-full flex-shrink-0" style="background: var(--workspace-low-2)"></div>
              <span class="text-sm text-neutral-700 truncate group-hover:text-neutral-900">RI Location</span>
            </div>
            <div class="flex-1 h-1.5 bg-neutral-100 rounded-full relative">
              <div class="absolute left-0 top-0 h-full rounded-full transition-all" style="width: 4%; min-width: 6px; background: var(--workspace-low-2)"></div>
              <span class="absolute right-0 top-1/2 -translate-y-1/2 px-2 py-0.5 bg-neutral-800 text-white text-xs rounded opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none">4%</span>
            </div>
          </a>
        `;
      }
      
      // Recent activity with card design and thumbnails
      const activity = document.getElementById('recent-activity');
      if (activity) {
        activity.innerHTML = `
          <!-- Pending Approval Request 1 -->
          <a href="#" onclick="openApprovalModal(event, 1)" data-type="approvals" class="block bg-white rounded-xl p-4 shadow-sm border border-neutral-100 hover:shadow-md transition-shadow group cursor-pointer relative">
            <div class="absolute top-3 right-3 w-2.5 h-2.5 bg-warning-400 rounded-full"></div>
            <div class="flex items-center gap-4">
              <img src="assets/email1.png" alt="Campaign preview" class="w-16 h-16 rounded-lg object-cover flex-shrink-0 border border-neutral-100">
              <div class="flex-1 min-w-0">
                <p class="text-sm font-medium text-neutral-600 mb-1.5">Campaign approval request</p>
                <div class="flex items-center gap-2">
                  <div class="w-5 h-5 bg-accent-500 rounded-full flex items-center justify-center text-white text-[9px] font-bold flex-shrink-0">GE</div>
                  <span class="text-xs text-neutral-500">UPS Greenwich</span>
                  <span class="text-xs text-neutral-400 ml-auto">5 m ago</span>
                </div>
              </div>
            </div>
          </a>
          
          <!-- Pending Approval Request 2 -->
          <a href="#" onclick="openApprovalModal(event, 2)" data-type="approvals" class="block bg-white rounded-xl p-4 shadow-sm border border-neutral-100 hover:shadow-md transition-shadow group cursor-pointer relative">
            <div class="absolute top-3 right-3 w-2.5 h-2.5 bg-warning-400 rounded-full"></div>
            <div class="flex items-center gap-4">
              <img src="assets/email2.png" alt="Campaign preview" class="w-16 h-16 rounded-lg object-cover flex-shrink-0 border border-neutral-100">
              <div class="flex-1 min-w-0">
                <p class="text-sm font-medium text-neutral-600 mb-1.5">Campaign approval request</p>
                <div class="flex items-center gap-2">
                  <div class="w-5 h-5 bg-accent-500 rounded-full flex items-center justify-center text-white text-[9px] font-bold flex-shrink-0">GE</div>
                  <span class="text-xs text-neutral-500">UPS Greenwich</span>
                  <span class="text-xs text-neutral-400 ml-auto">1 hr ago</span>
                </div>
              </div>
            </div>
          </a>
          
          <!-- New Workspace Created -->
          <a href="workspaces-list.html" data-type="workspaces" class="block bg-white rounded-xl p-4 shadow-sm border border-neutral-100 hover:shadow-md transition-shadow group cursor-pointer">
            <div class="flex items-center gap-4">
              <div class="w-16 h-16 rounded-full bg-main-200 flex items-center justify-center flex-shrink-0">
                <i data-lucide="layout-grid" class="w-6 h-6 text-main-600"></i>
              </div>
              <div class="flex-1 min-w-0">
                <p class="text-sm font-medium text-neutral-600 mb-1.5">New GE workspace created</p>
                <div class="flex items-center gap-2">
                  <div class="w-5 h-5 bg-success-600 rounded-full flex items-center justify-center text-white text-[9px] font-bold flex-shrink-0">GL</div>
                  <span class="text-xs text-neutral-500">UPS Global</span>
                  <span class="text-xs text-neutral-400 ml-auto">1 day ago</span>
                </div>
              </div>
            </div>
          </a>
          
          <!-- Email Campaign Scheduled -->
          <a href="#" data-type="campaigns" class="block bg-white rounded-xl p-4 shadow-sm border border-neutral-100 hover:shadow-md transition-shadow group cursor-pointer">
            <div class="flex items-center gap-4">
              <img src="assets/email3.png" alt="Campaign preview" class="w-16 h-16 rounded-lg object-cover flex-shrink-0 border border-neutral-100">
              <div class="flex-1 min-w-0">
                <p class="text-sm font-medium text-neutral-600 mb-1.5">Email campaign scheduled</p>
                <div class="flex items-center gap-2">
                  <div class="w-5 h-5 bg-main-500 rounded-full flex items-center justify-center text-white text-[9px] font-bold flex-shrink-0">NE</div>
                  <span class="text-xs text-neutral-500">UPS NE Region</span>
                  <span class="text-xs text-neutral-400 ml-auto">2 days ago</span>
                </div>
              </div>
            </div>
          </a>
          
          <!-- Email Campaign Sent -->
          <a href="#" data-type="campaigns" class="block bg-white rounded-xl p-4 shadow-sm border border-neutral-100 hover:shadow-md transition-shadow group cursor-pointer">
            <div class="flex items-center gap-4">
              <img src="assets/email4.png" alt="Campaign preview" class="w-16 h-16 rounded-lg object-cover flex-shrink-0 border border-neutral-100">
              <div class="flex-1 min-w-0">
                <p class="text-sm font-medium text-neutral-600 mb-1.5">Email campaign sent</p>
                <div class="flex items-center gap-2">
                  <div class="w-5 h-5 bg-main-500 rounded-full flex items-center justify-center text-white text-[9px] font-bold flex-shrink-0">NE</div>
                  <span class="text-xs text-neutral-500">UPS NE Region</span>
                  <span class="text-xs text-neutral-400 ml-auto">3 days ago</span>
                </div>
              </div>
            </div>
          </a>
      `;
        activity.className = 'space-y-3';
        
        // Re-apply current filter if active
        if (currentActivityFilter !== 'all') {
          filterActivityItems(currentActivityFilter);
        }
      }
      
      lucide.createIcons();
    }
    
    function updateMetric(id, value, isEmpty) {
      const el = document.getElementById(id);
      if (el) {
        el.textContent = value;
        if (isEmpty) {
          el.classList.remove('text-neutral-900');
          el.classList.add('text-neutral-300');
        } else {
          el.classList.remove('text-neutral-300');
          el.classList.add('text-neutral-900');
        }
      }
    }
    
    // Apply persisted data mode on page load
    setDataMode(currentDataMode);
    
    // Date range data sets
    const dateRangeData = {
      '1M': {
        sends: '12.4k',
        opens: '8.2k',
        clicks: '2.1k',
        bounces: '0.3%',
        views: '45.2k',
        likes: '1.8k',
        contacts: '2,847',
        templates: '34',
        topWorkspaces: [
          { name: 'NJ Location', initials: 'NJ', value: 24, percent: 80 },
          { name: 'NY Location', initials: 'NY', value: 18, percent: 60 },
          { name: 'CT Location', initials: 'CT', value: 12, percent: 40 }
        ],
        lowWorkspaces: [
          { name: 'MA Location', initials: 'MA', value: 2, percent: 8 },
          { name: 'RI Location', initials: 'RI', value: 1, percent: 4 }
        ]
      },
      '6M': {
        sends: '68.5k',
        opens: '42.1k',
        clicks: '11.8k',
        bounces: '0.4%',
        views: '245k',
        likes: '9.2k',
        contacts: '4,128',
        templates: '42',
        topWorkspaces: [
          { name: 'NY Location', initials: 'NY', value: 142, percent: 85 },
          { name: 'NJ Location', initials: 'NJ', value: 118, percent: 70 },
          { name: 'CT Location', initials: 'CT', value: 86, percent: 52 }
        ],
        lowWorkspaces: [
          { name: 'RI Location', initials: 'RI', value: 12, percent: 7 },
          { name: 'MA Location', initials: 'MA', value: 18, percent: 11 }
        ]
      },
      '1Y': {
        sends: '156k',
        opens: '98.4k',
        clicks: '28.2k',
        bounces: '0.5%',
        views: '520k',
        likes: '21.4k',
        contacts: '6,842',
        templates: '58',
        topWorkspaces: [
          { name: 'NY Location', initials: 'NY', value: 312, percent: 90 },
          { name: 'NJ Location', initials: 'NJ', value: 278, percent: 80 },
          { name: 'CT Location', initials: 'CT', value: 198, percent: 57 }
        ],
        lowWorkspaces: [
          { name: 'MA Location', initials: 'MA', value: 42, percent: 12 },
          { name: 'RI Location', initials: 'RI', value: 28, percent: 8 }
        ]
      }
    };
    
    let currentDateRange = '1M';
    
    function setDateRange(range) {
      currentDateRange = range;
      
      // Update toggle button states
      const buttons = document.querySelectorAll('#date-range-toggle button');
      buttons.forEach(btn => {
        if (btn.dataset.range === range) {
          btn.className = 'px-5 py-2 text-sm font-medium text-neutral-700 bg-neutral-100 rounded-xl transition-colors';
        } else {
          btn.className = 'px-5 py-2 text-sm text-neutral-400 hover:text-neutral-600 rounded-xl transition-colors';
        }
      });
      
      // Only update if in filled mode
      if (currentDataMode === 'filled') {
        updateDashboardData(range);
      }
    }
    
    function updateDashboardData(range) {
      const data = dateRangeData[range];
      if (!data) return;
      
      // Update metrics
      document.getElementById('metric-sends').textContent = data.sends;
      document.getElementById('metric-opens').textContent = data.opens;
      document.getElementById('metric-clicks').textContent = data.clicks;
      document.getElementById('metric-bounces').textContent = data.bounces;
      document.getElementById('metric-views').textContent = data.views;
      document.getElementById('metric-likes').textContent = data.likes;
      document.getElementById('metric-contacts').textContent = data.contacts;
      document.getElementById('metric-templates').textContent = data.templates;
      
      // Update top workspaces
      const topWs = document.getElementById('top-workspaces');
      if (topWs) {
        topWs.innerHTML = data.topWorkspaces.map((ws, i) => `
          <a href="workspace-detail.html?id=${ws.id || ws.name.toLowerCase().replace(' ', '-')}" class="flex items-center gap-3 group hover:bg-neutral-50 -mx-2 px-2 py-1 rounded-lg transition-colors cursor-pointer">
            <div class="flex items-center gap-2 w-28 flex-shrink-0">
              <div class="w-2 h-2 rounded-full flex-shrink-0" style="background: var(--workspace-${i + 1})"></div>
              <span class="text-sm text-neutral-700 truncate group-hover:text-neutral-900">${ws.name}</span>
            </div>
            <div class="flex-1 h-1.5 bg-neutral-100 rounded-full relative">
              <div class="absolute left-0 top-0 h-full rounded-full transition-all" style="width: ${ws.percent}%; background: var(--workspace-${i + 1})"></div>
              <span class="absolute right-0 top-1/2 -translate-y-1/2 px-2 py-0.5 bg-neutral-800 text-white text-xs rounded opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none">${ws.percent}%</span>
            </div>
          </a>
        `).join('');
      }
      
      // Update low workspaces
      const lowWs = document.getElementById('low-workspaces');
      if (lowWs) {
        lowWs.innerHTML = data.lowWorkspaces.map((ws, i) => `
          <a href="workspace-detail.html?id=${ws.id || ws.name.toLowerCase().replace(' ', '-')}" class="flex items-center gap-3 group hover:bg-neutral-50 -mx-2 px-2 py-1 rounded-lg transition-colors cursor-pointer">
            <div class="flex items-center gap-2 w-28 flex-shrink-0">
              <div class="w-2 h-2 rounded-full flex-shrink-0" style="background: var(--workspace-low-${i + 1})"></div>
              <span class="text-sm text-neutral-700 truncate group-hover:text-neutral-900">${ws.name}</span>
            </div>
            <div class="flex-1 h-1.5 bg-neutral-100 rounded-full relative">
              <div class="absolute left-0 top-0 h-full rounded-full transition-all" style="width: ${ws.percent}%; min-width: 6px; background: var(--workspace-low-${i + 1})"></div>
              <span class="absolute right-0 top-1/2 -translate-y-1/2 px-2 py-0.5 bg-neutral-800 text-white text-xs rounded opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none">${ws.percent}%</span>
            </div>
          </a>
        `).join('');
      }
    }
    
    // Donut chart hover interactions
    function initDonutInteractions() {
      const tooltip = document.getElementById('donut-tooltip');
      const segments = document.querySelectorAll('.donut-segment');
      const donutContainer = document.querySelector('.donut-container');
      
      if (!tooltip || !segments.length) return;
      
      function showTooltip(index, x, y) {
        const segment = document.querySelector(`.donut-segment[data-index="${index}"]`);
        if (!segment) return;
        
        const label = segment.dataset.label;
        const value = segment.dataset.value;
        const percent = segment.dataset.percent;
        
        tooltip.innerHTML = `<span class="inline-flex items-center gap-1.5"><span class="w-2 h-2 rounded-full" style="background: var(--donut-${parseInt(index) + 1})"></span>${label}</span>`;
        tooltip.style.left = x + 'px';
        tooltip.style.top = y + 'px';
        tooltip.classList.add('visible');
        
        // Dim other segments
        segments.forEach(seg => {
          seg.style.opacity = seg.dataset.index === index.toString() ? '1' : '0.3';
        });
      }
      
      function hideTooltip() {
        tooltip.classList.remove('visible');
        segments.forEach(seg => seg.style.opacity = '1');
      }
      
      // Segment hover
      segments.forEach(segment => {
        segment.addEventListener('mouseenter', (e) => {
          const rect = donutContainer.getBoundingClientRect();
          const x = e.clientX - rect.left;
          const y = e.clientY - rect.top;
          showTooltip(segment.dataset.index, x, y);
        });
        
        segment.addEventListener('mousemove', (e) => {
          const rect = donutContainer.getBoundingClientRect();
          tooltip.style.left = (e.clientX - rect.left) + 'px';
          tooltip.style.top = (e.clientY - rect.top) + 'px';
        });
        
        segment.addEventListener('mouseleave', hideTooltip);
      });
    }
    
    // Initialize donut interactions
    initDonutInteractions();
  </script>
</body>
</html>
